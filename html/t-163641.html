<html xmlns="http://www.w3.org/1999/xhtml" dir="ltr" lang="en"><head><meta charset="utf-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width,initial-scale=1"><meta name="description" content="Mathy question..."><title>Mathy question... - AVS Forums</title><script>(function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){(i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)})(window,document,'script','https://www.google-analytics.com/analytics.js','ga');ga('create','UA-53539506-7','auto');ga('send','pageview');</script><link href="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.3.7/css/bootstrap.min.css" rel="stylesheet"><!--[if lt IE 9]><script src="https://oss.maxcdn.com/libs/html5shiv/3.7.0/html5shiv.js"></script><script src="https://oss.maxcdn.com/libs/respond.js/1.3.0/respond.min.js"></script><![endif]--></head><body style="display:none"><div class="container"><div class="row"><div class="dropdown pull-right"><button class="btn btn-link btn-sm dropdown-toggle" type="button" data-toggle="dropdown">Change style <span class="caret"></span></button><ul id="css-select" class="dropdown-menu" role="menu"><li><a href="#" rel="//netdna.bootstrapcdn.com/bootstrap/3.0.2/css/bootstrap.min.css">Default</a></li><li role="presentation" class="divider"></li><li role="presentation" class="dropdown-header">Bootswatch</li><li><a href="#" rel="https://cdnjs.cloudflare.com/ajax/libs/bootswatch/3.3.7/amelia/bootstrap.min.css">Amelia</a></li><li><a href="#" rel="https://cdnjs.cloudflare.com/ajax/libs/bootswatch/3.3.7/cerulean/bootstrap.min.css">Cerulean</a></li><li><a href="#" rel="https://cdnjs.cloudflare.com/ajax/libs/bootswatch/3.3.7/cosmo/bootstrap.min.css">Cosmo</a></li><li><a href="#" rel="https://cdnjs.cloudflare.com/ajax/libs/bootswatch/3.3.7/cyborg/bootstrap.min.css">Cyborg</a></li><li><a href="#" rel="https://cdnjs.cloudflare.com/ajax/libs/bootswatch/3.3.7/flatly/bootstrap.min.css">Flatly</a></li><li><a href="#" rel="https://cdnjs.cloudflare.com/ajax/libs/bootswatch/3.3.7/journal/bootstrap.min.css">Journal</a></li><li><a href="#" rel="https://cdnjs.cloudflare.com/ajax/libs/bootswatch/3.3.7/readable/bootstrap.min.css">Readable</a></li><li><a href="#" rel="https://cdnjs.cloudflare.com/ajax/libs/bootswatch/3.3.7/simplex/bootstrap.min.css">Simplex</a></li><li><a href="#" rel="https://cdnjs.cloudflare.com/ajax/libs/bootswatch/3.3.7/slate/bootstrap.min.css">Slate</a></li><li><a href="#" rel="https://cdnjs.cloudflare.com/ajax/libs/bootswatch/3.3.7/spacelab/bootstrap.min.css">Spacelab</a></li><li><a href="#" rel="https://cdnjs.cloudflare.com/ajax/libs/bootswatch/3.3.7/united/bootstrap.min.css">United</a></li><li><a href="#" rel="https://cdnjs.cloudflare.com/ajax/libs/bootswatch/3.3.7/yeti/bootstrap.min.css">Yeti</a></li></ul></div></div><ol class="breadcrumb"><li><a href="../index.html" class="glyphicon glyphicon-home"></a></li><li><a href="f-85.html">AVS</a></li><li class="active">Mathy question...</li></ol><p class="lead text-muted">Archive: <a title="Try the Internet Archive" target="_blank" href="http://web.archive.org/web/*/forums.winamp.com/showthread.php?t=163641">Mathy question...</a></p><br><div class="post"><p class="post-meta"><span class="post-author text-primary">UIUC85</span><br></p><p class="post-time small text-muted">7th January 2004 08:25 <abbr title="Coordinated Universal Time">UTC</abbr></p><p class="post-content"><strong>Mathy question...</strong><br>Ok so I see all this mentioning of Whittaker iteration and Newton-Raphson something (well I guess it was just in UnConeD's presets). Care to explain what it can do other than simple approximations? Or providing a decent site works just as well.<br><br>Actually let me specify. Can you give me some decent examples as to where these methods could be used.</p></div><hr><div class="post"><p class="post-meta"><span class="post-author text-primary">UnConeD</span><br></p><p class="post-time small text-muted">7th January 2004 15:14 <abbr title="Coordinated Universal Time">UTC</abbr></p><p class="post-content">Whittaker iteration and Newton-Raphson are 2 methods of finding roots of a function. This means:<br><br>Given a function f(x), find x so that f(x) = 0.<br><br>For simple equations (linear, quadratic) you can just calculate x directly. For more complicated equations, this is either very hard to do or even impossible, and so-called numerical/iterative methods are used instead.<br><br>Iterative methods start with a guess or approximation of x (let's call it x[0]) and based on that, calculate a better approximation (x[1]). By repeatedly applying the formula, x[k] will get closer to the real value of x where f(x) = 0.<br><br>The formula for newton-raphson is:<br><br>x[k+1] = x[k] - f(x[k])/f'(x[k])<br><br>where x[k] is the k'th iteration result, f(x) is the function and f'(x) is its derivative.<br>When the derivative is complicated and/or erratic, you can use Whittaker iteration instead:<br><br>x[k+1] = x[k] - f(x[k])/a<br><br>where a is a parameter.<br><br>In AVS, this is used to solve complicated equations for raytracing, e.g. quartics (VJ Chmutov for example).<br>When you have no idea of calculating a good initial guess x[0], it's best to use Whittaker iteration. If you have a good initial guess, Newton-Raphson will converge much more quickly.<br><br>For raytracing, Newton-Rapson will get unstable where the surface is tangent to the viewing direction and cause weird artifacts. Also in raytracing, you don't need all roots, just the root with smallest, positive x. If you pick the right sign and magnitude for the Whittaker parameter, this method will always converge on the right root.<br><br>I've had some success using a hybrid Newton-Raphson/Whittaker:<br><br>x[k+1] = x[k] - f(x[k])/(f'(x[k])*a + b)<br><br>where a and b are parameters. I used this in my flag DM. I first calculate the flag as if it was flat (a plane), and then use NR/H to approximate the flag.<br><br>Something that I've thought of but haven't tried yet is:<br><br>x[k+1] = x[k] + f(x[k])/max(abs(f'(x[k])),b)*sign(f'(x[k]))<br><br>This would have the advantage of NR's fast convergence for good approximations, and reverting back to Whittaker when it's not yet close.<br><br>In AVS, Whittaker is almost always the fastest method, because if you invert the parameter (1/a instead of a), you don't need any divisions. Also, the derivative of a function you can't solve analytically is almost always complicated.<br>The extra iterations needed for a good approximation with Whittaker are compensated by the simplicity of each iteration.<br><br>For more information, check Mathworld or pick up a Numerical Maths book. The problem with applying most methods to AVS is that most numerical methods are designed to get you accurate results in a reasonable amount of time, while in AVS you just need approximate results really fast.</p></div><hr><div class="post"><p class="post-meta"><span class="post-author text-primary">UIUC85</span><br></p><p class="post-time small text-muted">7th January 2004 20:51 <abbr title="Coordinated Universal Time">UTC</abbr></p><p class="post-content">Thanks UnConeD :)<br><br>Quick questions though. In the Whittaker approach, isn't the initial x[k] still a guess? You said if you have no idea what the initial guess might be then use whittaker...<br>And do you just set 'a' arbitrarily? Is there some rule for setting it or what?</p></div><hr><div class="post"><p class="post-meta"><span class="post-author text-primary">UnConeD</span><br></p><p class="post-time small text-muted">8th January 2004 02:14 <abbr title="Coordinated Universal Time">UTC</abbr></p><p class="post-content">For Whittaker I usually start at x[0] = 0, so yes that's an initial 'guess', but not in any way accurate. For my flag DM, using a flat flag as an initial guess is much better, because it already has an approximate depth that matches the camera rotation/orientation.<br><br>For raytracing you want the smallest positive root (larger than 0), so with Whittaker you'll want to assign 'a' the opposite sign of f(0), so that x[1] &gt; 0. The choice for a is normally a guess at f'(x) in the desired root. You have to pick it high enough so that it won't skip over the first root and converge on the next one.<br><br>It's best to normalize your ray-direction for whittaker, because otherwise your steps are larger at the side of the window than in the middle.</p></div><hr><div class="post"><p class="post-meta"><span class="post-author text-primary">UIUC85</span><br></p><p class="post-time small text-muted">8th January 2004 07:37 <abbr title="Coordinated Universal Time">UTC</abbr></p><p class="post-content">Alright so I see how they work and I see how I can use them to approximate roots of numbers but I dont see how I can use this to find intersections of rays...</p></div><hr><div class="post"><p class="post-meta"><span class="post-author text-primary">UnConeD</span><br></p><p class="post-time small text-muted">8th January 2004 10:54 <abbr title="Coordinated Universal Time">UTC</abbr></p><p class="post-content">Not intersections of rays, intersections of rays with shapes.<br>If you have a general implicit equation for a shape f(x,y,z) = 0, you replace (x,y,z) by (k*dx+ox, k*dy+oy, k*dz+oz), where (dx,dy,dz) is your ray direction and (ox,oy,oz) is the ray origin. You then solve the resulting equation in k: f(k)=0 (usually only the smallest positive root is needed).<br>The point where the ray intersects your object is (k*dx+ox, k*dy+oy, k*dz+oz).</p></div><hr><div class="post"><p class="post-meta"><span class="post-author text-primary">UIUC85</span><br></p><p class="post-time small text-muted">8th January 2004 19:35 <abbr title="Coordinated Universal Time">UTC</abbr></p><p class="post-content">No, I've written raytracers before but I just did something stupid. Nevermind. Thanks for the good explanation on those methods.</p></div><hr><div class="post"><p class="post-meta"><span class="post-author text-primary">UIUC85</span><br></p><p class="post-time small text-muted">9th January 2004 00:05 <abbr title="Coordinated Universal Time">UTC</abbr></p><p class="post-content">Cant edit. sorry<br><br>Actually can you use it to solve the intersection points directly with out simplifying the equations? Just plug in the rays into the equation for your shape and make sure it's set equal to zero and then use Whittaker iteration to get the closest zero? It looks like you simplified the Chmutov Surface down to an easier quartic but could you just leave it? I tried it on a sphere and it seems to work, I just didn't work out the texture mapping.</p></div><hr><div class="post"><p class="post-meta"><span class="post-author text-primary">S-uper_T-oast</span><br></p><p class="post-time small text-muted">9th January 2004 02:15 <abbr title="Coordinated Universal Time">UTC</abbr></p><p class="post-content">That is an excelent explanation UnConeD! I know understand how those work! Thank you very much!</p></div><hr><div class="post"><p class="post-meta"><span class="post-author text-primary">UIUC85</span><br></p><p class="post-time small text-muted">9th January 2004 09:50 <abbr title="Coordinated Universal Time">UTC</abbr></p><p class="post-content">mmmm I'm assuming simplifying was just for optimiztion purposes?</p></div><hr><div class="post"><p class="post-meta"><span class="post-author text-primary">UnConeD</span><br></p><p class="post-time small text-muted">9th January 2004 17:11 <abbr title="Coordinated Universal Time">UTC</abbr></p><p class="post-content">It makes sense to only calculate the values that actually change: for polynomials the coefficients are constant and it would be crazy to recalculate them per iteration.<br><br>Optimizing is always a good idea. Another thing you should consider is modifying your equation so it's easier to calculate and has (almost) the same result.<br>For example, the falloff function for my 3D metaballs was chosen to be a polynomial of distance which only contains even powers of distance: no square root is required for calculating it, and speeds it up some more.</p></div><hr><div class="footer"><p class="text-muted small">Fork me on <a href="https://github.com/visbot/AVS-Forums/">GitHub</a></p></div></div><script type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.2.1/jquery.min.js"></script><script type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.3.7/js/bootstrap.min.js"></script><script type="text/javascript" src="../js/jquery.cookie.min.js"></script><script type="text/javascript" src="../js/scripts.js"></script></body></html>