<html xmlns="http://www.w3.org/1999/xhtml" dir="ltr" lang="en">
<head>
  <meta charset="utf-8" />
  <meta http-equiv="X-UA-Compatible" content="IE=edge" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <meta name="description" content="A question of speed." />

  <title>A question of speed. - AVS Forums</title><!-- Bootstrap core CSS -->
  <link rel="stylesheet" type="text/css" href="//netdna.bootstrapcdn.com/bootswatch/3.0.2/readable/bootstrap.min.css" /><!-- HTML5 shim and Respond.js IE8 support of HTML5 elements and media queries -->
  <!--[if lt IE 9]>
                <script src="https://oss.maxcdn.com/libs/html5shiv/3.7.0/html5shiv.js"></script>
                <script src="https://oss.maxcdn.com/libs/respond.js/1.3.0/respond.min.js"></script>
        <![endif]-->
</head>

<body style="display:none">
  <div class="container">
    <div class="row">
        <div class="dropdown pull-right">
          <button class="btn btn-link btn-sm dropdown-toggle" type="button" data-toggle="dropdown">
            Change style
            <span class="caret"></span>
          </button>
          <ul id="css-select" class="dropdown-menu" role="menu">
            <li><a href="#" rel="//netdna.bootstrapcdn.com/bootstrap/3.0.2/css/bootstrap.min.css">Default</a></li>
            <li role="presentation" class="divider"></li>
            <li role="presentation" class="dropdown-header">Bootswatch</li>
            <li><a href="#" rel="//netdna.bootstrapcdn.com/bootswatch/3.0.2/amelia/bootstrap.min.css">Amelia</a></li>
            <li><a href="#" rel="//netdna.bootstrapcdn.com/bootswatch/3.0.2/cerulean/bootstrap.min.css">Cerulean</a></li>
            <li><a href="#" rel="//netdna.bootstrapcdn.com/bootswatch/3.0.2/cosmo/bootstrap.min.css">Cosmo</a></li>
            <li><a href="#" rel="//netdna.bootstrapcdn.com/bootswatch/3.0.2/cyborg/bootstrap.min.css">Cyborg</a></li>
            <li><a href="#" rel="//netdna.bootstrapcdn.com/bootswatch/3.0.2/flatly/bootstrap.min.css">Flatly</a></li>
            <li><a href="#" rel="//netdna.bootstrapcdn.com/bootswatch/3.0.2/journal/bootstrap.min.css">Journal</a></li>
            <li><a href="#" rel="//netdna.bootstrapcdn.com/bootswatch/3.0.2/readable/bootstrap.min.css">Readable</a></li>
            <li><a href="#" rel="//netdna.bootstrapcdn.com/bootswatch/3.0.2/simplex/bootstrap.min.css">Simplex</a></li>
            <li><a href="#" rel="//netdna.bootstrapcdn.com/bootswatch/3.0.2/slate/bootstrap.min.css">Slate</a></li>
            <li><a href="#" rel="//netdna.bootstrapcdn.com/bootswatch/3.0.2/spacelab/bootstrap.min.css">Spacelab</a></li>
            <li><a href="#" rel="//netdna.bootstrapcdn.com/bootswatch/3.0.2/united/bootstrap.min.css">United</a></li>
            <li><a href="#" rel="//netdna.bootstrapcdn.com/bootswatch/3.0.2/yeti/bootstrap.min.css">Yeti</a></li>
          </ul>
        </div>
    </div>

    <ol class="breadcrumb">
      <li><a href="../index.html" class="glyphicon glyphicon-home"></a></li>

      <li><a href="f-85.html">AVS</a></li>

      <li class="active">A question of speed.</li>
    </ol>

    <p class="lead text-muted">Archive: <a title="Try the Internet Archive" target="_blank" href="http://web.archive.org/web/*/forums.winamp.com/showthread.php?t=185651">A question of speed.</a></p><br />

    <div class="post">
      <p class="post-meta"><span class="post-author text-primary">your-dentist</span><br /></p>

      <p class="post-time small text-muted">6th July 2004 10:49 <abbr title="Coordinated Universal Time">UTC</abbr></p>

      <p class="post-content"><strong>A question of speed.</strong><br />
      When I build superscopes with individual coords for each points, I mostly use bnot() to do this.<br />
      Example: superscope has three points.<br />
      Coords are: x1, x2, x3 and y1, y2, y3<br />
      In perpoint textfield:<br />
      cnt=i*(n-1);<br />
      x=bnot(cnt)*x1+bnot(cnt-1)*x2+bnot(cnt-2)*x2;<br />
      y=bnot(cnt)*y1+bnot(cnt-1)*y2+bnot(cnt-2)*y2;<br />
      <br />
      So I recently read that multiplications are not good for this, because they're too slow.<br />
      Are multiplication with 1 or 0 as slow as, let's say .693482*1.593782?<br />
      I mean 'whatever'*1 is 'whatever' and 'whatever'*0 is 0.<br />
      Is it faster to use IFs in this case?</p>
    </div>
    <hr />

    <div class="post">
      <p class="post-meta"><span class="post-author text-primary">piR</span><br /></p>

      <p class="post-time small text-muted">6th July 2004 13:14 <abbr title="Coordinated Universal Time">UTC</abbr></p>

      <p class="post-content">For only three points in a superscope, I don't think any optimization is really needed ;)<br />
      <br />
      About multiplication, unless the compiler tries to make an optimization, the time needed to make a compute will be the same whatever the values multiplied.<br />
      <br />
      For a real optimization, you should better use a series of if(), because AVS only executes the necessary code (in you example, it always executes 3 bnot() and 3 multiplications, using if() it can only execute from 1 to 3 bnot(), and that's all).</p>
    </div>
    <hr />

    <div class="post">
      <p class="post-meta"><span class="post-author text-primary">Jaak</span><br /></p>

      <p class="post-time small text-muted">6th July 2004 16:24 <abbr title="Coordinated Universal Time">UTC</abbr></p>

      <p class="post-content">why not use ifs?<br />
      i think they the fastest. for less than... less say 200 points you really dont have to worry if you use ifs or multiplications<br />
      :p<br />
      just dont use divisions =)</p>
    </div>
    <hr />

    <div class="post">
      <p class="post-meta"><span class="post-author text-primary">your-dentist</span><br /></p>

      <p class="post-time small text-muted">6th July 2004 16:41 <abbr title="Coordinated Universal Time">UTC</abbr></p>

      <p class="post-content">Is there no case differentiation in the multiplication algo, that makes multiplication with whole numbers faster?<br />
      I prefer the bnot() method, because it's easier to read the source.<br />
      Having tons of if(b,if(1-c,if(a,0,d),1),5); things sux.<br />
      I gave up using division too.<br />
      Though /3 is shorter than *.333. :)</p>
    </div>
    <hr />

    <div class="post">
      <p class="post-meta"><span class="post-author text-primary">Raz</span><br /></p>

      <p class="post-time small text-muted">6th July 2004 22:35 <abbr title="Coordinated Universal Time">UTC</abbr></p>

      <p class="post-content">if you want easy to read just do this:<br />
      frame:<br />
      a=0;<br />
      point:<br />
      a=a+1;<br />
      x1=if(equal(a,1),point position on x axis,x1);<br />
      y1=if(equal(a,1),point position on y axis,y1);<br />
      x1=if(equal(a,2),point position on x axis,x1);<br />
      etc<br />
      x=x1;<br />
      y=y1;</p>
    </div>
    <hr />

    <div class="post">
      <p class="post-meta"><span class="post-author text-primary">NemoOrange</span><br /></p>

      <p class="post-time small text-muted">7th July 2004 20:45 <abbr title="Coordinated Universal Time">UTC</abbr></p>

      <p class="post-content">I've been experimenting along these lines &amp; I've been using i &amp; if statements.<br />
      <br />
      For your scope, you have 3 points, so n=3. The i "points" are located at 0, .5 and 1<br />
      <br />
      With this in mind, using a if statement short cut, you can skip the equal or above conditions &amp; just use values of i.<br />
      <br />
      I'm having trouble explaining it, but in the end you'll come up with:<br />
      <br />
      x=if(i,if(i-.5,x3,x2),x1);<br />
      y=if(i,if(i-.5,y3,y2),y1);<br />
      <br />
      I've done larger statements like these where n=9;<br />
      <br />
      x=if(i,if(i-1/8,if(i-2/8,if(i-3/8,if(i-4/8,if(i-5/8,if(i-6/8,if(i-7/8,x9,x8),x7),x6),x5),x4),x3),x2),x1)</p>
    </div>
    <hr />

    <div class="post">
      <p class="post-meta"><span class="post-author text-primary">Raz</span><br /></p>

      <p class="post-time small text-muted">7th July 2004 21:09 <abbr title="Coordinated Universal Time">UTC</abbr></p>

      <p class="post-content">Looks interesting nemo, but get rid of all those needless divisions. Makes it much slower.<br />
      <br />
      1/8 = 0.125<br />
      2/8 = 0.25<br />
      3/8 = 0.375<br />
      etc</p>
    </div>
    <hr />

    <div class="post">
      <p class="post-meta"><span class="post-author text-primary">piR</span><br /></p>

      <p class="post-time small text-muted">8th July 2004 12:46 <abbr title="Coordinated Universal Time">UTC</abbr></p>

      <p class="post-content"></p>

      <blockquote>
        <i>Originally posted by your-dentist</i><br />
        <b>Is there no case differentiation in the multiplication algo, that makes multiplication with whole numbers faster?<br /></b>
      </blockquote>By "whole numbers" I think you mean integer values (like 1 or 3, but not 1.5 or 3.05). Integer computes are faster than floating point computes (I'm not so sure with the actual processors), but these are two types of data stored differently in memory, and then, they use different instructions.<br />
      Unfortunately, AVS only uses floating point numbers, so, 0, 1, 12546.4567862 are all the same ... ;)
    </div>
    <hr />

    <div class="post">
      <p class="post-meta"><span class="post-author text-primary">NemoOrange</span><br /></p>

      <p class="post-time small text-muted">8th July 2004 16:31 <abbr title="Coordinated Universal Time">UTC</abbr></p>

      <p class="post-content"></p>

      <blockquote>
        <i>Originally posted by Raz</i><br />
        <b>Looks interesting nemo, but get rid of all those needless divisions. Makes it much slower.<br />
        <br />
        1/8 = 0.125<br />
        2/8 = 0.25<br />
        3/8 = 0.375<br />
        etc</b>
      </blockquote>Of course, but I wanted to point out the relationship between the fractions and n.<br />
      <br />
      Although, are you sure this is correct? I remember somebody mentioning how 1/3 is faster than .3333. Maybe I'm wrong.
    </div>
    <hr />

    <div class="post">
      <p class="post-meta"><span class="post-author text-primary">your-dentist</span><br /></p>

      <p class="post-time small text-muted">8th July 2004 21:50 <abbr title="Coordinated Universal Time">UTC</abbr></p>

      <p class="post-content">Anthoer way using megabuf().<br />
      I doubt that it's faster, because it needs to access the cache.<br />
      <br />
      All coords are put into the megabuf.<br />
      Like this:<br />
      assign(megabuf(0),x1);assign(megabuf(1),x2);<br />
      assign(megabuf(0+yoffset),y1);assign(megabuf(1+yoffset),y2);<br />
      <br />
      Then used like this:<br />
      Per point:<br />
      cnt=i*(n-1);<br />
      x=megabuf(cnt);<br />
      y=megabuf(cnt+yoffset);<br />
      <br />
      The var 'yoffset' can be chosen freely, though it must be bigger than the amount of individual point coords.</p>
    </div>
    <hr />

    <div class="post">
      <p class="post-meta"><span class="post-author text-primary">Jaak</span><br /></p>

      <p class="post-time small text-muted">9th July 2004 16:28 <abbr title="Coordinated Universal Time">UTC</abbr></p>

      <p class="post-content"></p>

      <blockquote>
        <i>Originally posted by NemoOrange</i><br />
        Although, are you sure this is correct? I remember somebody mentioning how 1/3 is faster than .3333. Maybe I'm wrong. [/B]
      </blockquote>single blank (even no n=1 foo) ssc, code in frame part window size at 256x256<br />
      <pre>
<code><br />loop(2000,<br /> loop(2000,<br />  assign(a,a/3)<br /> )<br />);</code>
</pre><br />
      8.8 FPS<br />
      <pre>
<code><br />loop(2000,<br /> loop(2000,<br />  assign(a,a*.333)<br /> )<br />);</code>
</pre><br />
      11.1 FPS<br />
      <br />
      yes, it does make difference<br />
      <br />
      <br />
      [edit]<br />
      @yourdentist, not that new idea, apparently slower too.<br />
      Its realyl useful in TomyLobos triangle ape, if it gets released youll see my examples and way of using gmegabuf :p
    </div>
    <hr />

    <div class="post">
      <p class="post-meta"><span class="post-author text-primary">dirkdeftly</span><br /></p>

      <p class="post-time small text-muted">9th July 2004 17:57 <abbr title="Coordinated Universal Time">UTC</abbr></p>

      <p class="post-content">1/3 is more accurate than .3333, but not faster<br />
      <br />
      *however*<br />
      <br />
      unless you're going over a division 4,000,000 times, you're not going to lose 3.3 fps over it. and it would take running over a division 100,000 times to even lose .1 fps. it's really not that big of a deal, and in many cases using the division is a lot more convenient than the decimal.<br />
      so jaak, for the love of god, stop obsessing over divisions. there are more important optimisations.<br />
      <br />
      <br />
      your-dentist: avs is really quite shitty and not well optimised, and afaik x*1 and x*0 are no faster than x*1.23456789. the bottom line is, ifs are faster than mults, and the difference in speed is not quite as negligible as that between a division and a multiplication.<br />
      (so yeah, this is one of those important optimisations)</p>
    </div>
    <hr />

    <div class="post">
      <p class="post-meta"><span class="post-author text-primary">Jaak</span><br /></p>

      <p class="post-time small text-muted">10th July 2004 09:13 <abbr title="Coordinated Universal Time">UTC</abbr></p>

      <p class="post-content"></p>

      <blockquote>
        <i>Originally posted by Atero</i><br />
        <b>so jaak, for the love of god, stop obsessing over divisions. there are more important optimisations.</b>
      </blockquote>yes, it does't matter *that* much, but in quite heavy scopes it will matter, besides it allways feels good to code optimized code :p
    </div>
    <hr />

    <div class="post">
      <p class="post-meta"><span class="post-author text-primary">TomyLobo</span><br /></p>

      <p class="post-time small text-muted">13th July 2004 20:44 <abbr title="Coordinated Universal Time">UTC</abbr></p>

      <p class="post-content">about the speed difference between using megabuf() and if/equal/bnot/whatever:<br />
      megabuf() is most probably faster in terms of memory access because it accesses memory only 4 times:<br />
      1. fetch the index (if it isnt already in the fpu from previous calculations) (prolly fld [e*x])<br />
      <br />
      2. store the index to a temporary integer (fist [ebp+/-something])<br />
      <br />
      3. put the index into a cpu register (mov e*x, [ebp+/-something])<br />
      <br />
      4. get the value from the megabuf using that index and the base address of the megabuf (fld [e*x+e*x])<br />
      <br />
      that would be a complexity of 4 which is a constant cost while using if()s, equal()s or bnot()s would require a linear amount of time which would be slower if you have more than 3 or 4 or so...</p>
    </div>
    <hr />

    <div class="post">
      <p class="post-meta"><span class="post-author text-primary">your-dentist</span><br /></p>

      <p class="post-time small text-muted">14th July 2004 15:42 <abbr title="Coordinated Universal Time">UTC</abbr></p>

      <p class="post-content">Sounds plausible.<br />
      So for high amounts of points, using megabuf() is faster.<br />
      Whoa, you really seem to have become an expert at AVS code!</p>
    </div>
    <hr />

    <div class="post">
      <p class="post-meta"><span class="post-author text-primary">TomyLobo</span><br /></p>

      <p class="post-time small text-muted">17th July 2004 15:40 <abbr title="Coordinated Universal Time">UTC</abbr></p>

      <p class="post-content">a little ASM knowledge helps ;)</p>
    </div>
    <hr />

    <div class="post">
      <p class="post-meta"><span class="post-author text-primary">jheriko</span><br /></p>

      <p class="post-time small text-muted">28th July 2004 20:01 <abbr title="Coordinated Universal Time">UTC</abbr></p>

      <p class="post-content">btw, if you want to know whats fastest you should get the winamp sdk and look at the evallib source. the actual functions are in nseel-cfunc.c, the pro/epilogs are in the nseel-addfuncs.h file<br />
      <br />
      its all pretty interesting but you need to be a real tech head to understand 90% of the rest of it cos its written in c and asm and in a code style almost totally unreadable to me (and therefore by logical extension everyone :P).</p>
    </div>
    <hr />

    <div class="footer">
      <p class="text-muted small">Fork me on <a href="https://github.com/visbot/AVS-Forums/">GitHub</a></p>
    </div>
  </div><!-- Put JavaScript here -->
  <script type="text/javascript" src="//code.jquery.com/jquery-1.10.2.min.js"></script>
<script type="text/javascript" src="//netdna.bootstrapcdn.com/bootstrap/3.0.2/js/bootstrap.min.js"></script>
  <script type="text/javascript" src="../js/jquery.cookie.min.js"></script>
  <script type="text/javascript" src="../js/scripts.js"></script>
</body>
</html>
