<html xmlns="http://www.w3.org/1999/xhtml" dir="ltr" lang="en"><head><meta charset="utf-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width,initial-scale=1"><meta name="description" content="Adding 'x' millisecond delay between beat and Visualisation reaction"><title>Adding 'x' millisecond delay between beat and Visualisation reaction - AVS Forums</title><script>(function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){(i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)})(window,document,'script','https://www.google-analytics.com/analytics.js','ga');ga('create','UA-53539506-7','auto');ga('send','pageview');</script><link rel="preload" href="https://cdnjs.cloudflare.com/ajax/libs/bootswatch/3.3.7/readable/bootstrap.min.css" as="style" onload="this.rel='stylesheet'"> <noscript><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/bootswatch/3.3.7/readable/bootstrap.min.css"></noscript> <script>!function(a){"use strict";var b=function(b,c,d){function e(a){return h.body?a():void setTimeout(function(){e(a)})}function f(){i.addEventListener&&i.removeEventListener("load",f),i.media=d||"all"}var g,h=a.document,i=h.createElement("link");if(c)g=c;else{var j=(h.body||h.getElementsByTagName("head")[0]).childNodes;g=j[j.length-1]}var k=h.styleSheets;i.rel="stylesheet",i.href=b,i.media="only x",e(function(){g.parentNode.insertBefore(i,c?g:g.nextSibling)});var l=function(a){for(var b=i.href,c=k.length;c--;)if(k[c].href===b)return a();setTimeout(function(){l(a)})};return i.addEventListener&&i.addEventListener("load",f),i.onloadcssdefined=l,l(f),i};"undefined"!=typeof exports?exports.loadCSS=b:a.loadCSS=b}("undefined"!=typeof global?global:this);!function(a){if(a.loadCSS){var b=loadCSS.relpreload={};if(b.support=function(){try{return a.document.createElement("link").relList.supports("preload")}catch(b){return!1}},b.poly=function(){for(var b=a.document.getElementsByTagName("link"),c=0;c<b.length;c++){var d=b[c];"preload"===d.rel&&"style"===d.getAttribute("as")&&(a.loadCSS(d.href,d,d.getAttribute("media")),d.rel=null)}},!b.support()){b.poly();var c=a.setInterval(b.poly,300);a.addEventListener&&a.addEventListener("load",function(){b.poly(),a.clearInterval(c)}),a.attachEvent&&a.attachEvent("onload",function(){a.clearInterval(c)})}}}(this);</script></head><body style="display:none"><div class="container"><div class="row"><div class="dropdown pull-right"><button class="btn btn-link btn-sm dropdown-toggle" type="button" data-toggle="dropdown">Change style <span class="caret"></span></button><ul id="css-select" class="dropdown-menu" role="menu"><li><a href="#" rel="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.3.7/css/bootstrap.min.css">Default</a></li><li role="presentation" class="divider"></li><li role="presentation" class="dropdown-header">Bootswatch</li><li><a href="#" rel="https://cdnjs.cloudflare.com/ajax/libs/bootswatch/3.3.7/amelia/bootstrap.min.css">Amelia</a></li><li><a href="#" rel="https://cdnjs.cloudflare.com/ajax/libs/bootswatch/3.3.7/cerulean/bootstrap.min.css">Cerulean</a></li><li><a href="#" rel="https://cdnjs.cloudflare.com/ajax/libs/bootswatch/3.3.7/cosmo/bootstrap.min.css">Cosmo</a></li><li><a href="#" rel="https://cdnjs.cloudflare.com/ajax/libs/bootswatch/3.3.7/cyborg/bootstrap.min.css">Cyborg</a></li><li><a href="#" rel="https://cdnjs.cloudflare.com/ajax/libs/bootswatch/3.3.7/flatly/bootstrap.min.css">Flatly</a></li><li><a href="#" rel="https://cdnjs.cloudflare.com/ajax/libs/bootswatch/3.3.7/journal/bootstrap.min.css">Journal</a></li><li><a href="#" rel="https://cdnjs.cloudflare.com/ajax/libs/bootswatch/3.3.7/readable/bootstrap.min.css">Readable</a></li><li><a href="#" rel="https://cdnjs.cloudflare.com/ajax/libs/bootswatch/3.3.7/simplex/bootstrap.min.css">Simplex</a></li><li><a href="#" rel="https://cdnjs.cloudflare.com/ajax/libs/bootswatch/3.3.7/slate/bootstrap.min.css">Slate</a></li><li><a href="#" rel="https://cdnjs.cloudflare.com/ajax/libs/bootswatch/3.3.7/spacelab/bootstrap.min.css">Spacelab</a></li><li><a href="#" rel="https://cdnjs.cloudflare.com/ajax/libs/bootswatch/3.3.7/united/bootstrap.min.css">United</a></li><li><a href="#" rel="https://cdnjs.cloudflare.com/ajax/libs/bootswatch/3.3.7/yeti/bootstrap.min.css">Yeti</a></li></ul></div></div><ol class="breadcrumb"><li><a href="../index.html" class="glyphicon glyphicon-home"></a></li><li><a href="f-85.html">AVS</a></li><li class="active">Adding 'x' millisecond delay between beat and Visualisation reaction</li></ol><p class="lead text-muted">Archive: <a title="Try the Internet Archive" target="_blank" href="http://web.archive.org/web/*/forums.winamp.com/showthread.php?t=256376">Adding 'x' millisecond delay between beat and Visualisation reaction</a></p><br><div class="post"><p class="post-meta"><span class="post-author text-primary">Iceman_jkh</span><br></p><p class="post-time small text-muted">28th September 2006 04:38 <abbr title="Coordinated Universal Time">UTC</abbr></p><p class="post-content"><strong>Adding 'x' millisecond delay between beat and Visualisation reaction</strong><br>Hello fellow AVS user,<br><br>I know that the AVS source has been released for a while now, and I was wondering if there is ANY way to ADD an 'x' millisecond delay/lag to the display of the visualization?<br><br>The audio coming from my PC is about 100milliseconds slower than the Visuals on the screen, and I was wondering if anyone could tell me how to write a routine/edit the source in order to create a delay in the vis output. Or if such a plugin exists.<br><br>Please dont suggest using Line-In and another Winamp/Vis Combo as I cant use that in this case.<br><br>I would prefer to have a small input box, where I can set the number of milliseconds for the vis to lag by, or if thats difficult to do, Im happy to hardcode it as a constant and recompile source each time if thats easier for someone to explain 'how to' for me.<br><br>Thanks for your time, :)<br>Ice</p></div><hr><div class="post"><p class="post-meta"><span class="post-author text-primary">jheriko</span><br></p><p class="post-time small text-muted">28th September 2006 11:18 <abbr title="Coordinated Universal Time">UTC</abbr></p><p class="post-content">Making the change algorithmically is easy, you simply have to cache the oscilloscope/spectrum data and use an n ms old version for the vis plugin. You could do this at the 'entry point' for the library where winamp passes the plugin the data pointers.<br><br>The actual implementation isn't hard but requires you to know some API calls and understand C++ in general. You can look these things up for yourself because explaining them all here would be fruitless. Part of being a programmer is looking up libraries and functions and working out what to do with them yourself.<br><br><br>If I were you though I would try to work out why my audio has a delay of 100ms...</p></div><hr><div class="post"><p class="post-meta"><span class="post-author text-primary">Iceman_jkh</span><br></p><p class="post-time small text-muted">28th September 2006 11:41 <abbr title="Coordinated Universal Time">UTC</abbr></p><p class="post-content">Thanks Jheriko.<br><br>I know why my audio has a delay - its passing through some VERY tough VST plugins to shape the sound. So I'm not worried about that aspect, infact I WANT it. :)<br><br>Regarding using old data... is there any way to make the renderer render 'x' milliseconds late? or is that a harder thing than what you have described?<br><br>I do know a little about programming, but I dont have time to learn how to do this right now (although its probably not too complex, its still beyond my knowledge)... If someone was able to do it instead, Id be very grateful. Its not that I dont want to learn, but Ive got to get this project ready so soon :(.</p></div><hr><div class="post"><p class="post-meta"><span class="post-author text-primary">Iceman_jkh</span><br></p><p class="post-time small text-muted">30th September 2006 03:07 <abbr title="Coordinated Universal Time">UTC</abbr></p><p class="post-content">Anyone???<br><br>I have DL'ed the AVS source and the Winamp SDK and I have Visual Studio... any hints on how to actually do this?<br><br>Thanks<br>Ice</p></div><hr><div class="post"><p class="post-meta"><span class="post-author text-primary">Iceman_jkh</span><br></p><p class="post-time small text-muted">2nd October 2006 03:22 <abbr title="Coordinated Universal Time">UTC</abbr></p><p class="post-content">which API calls should I look at specifically?</p></div><hr><div class="post"><p class="post-meta"><span class="post-author text-primary">jheriko</span><br></p><p class="post-time small text-muted">18th October 2006 13:41 <abbr title="Coordinated Universal Time">UTC</abbr></p><p class="post-content">Try QueryPerformanceCounter and QueryPerformanceFrequency. Everything else you need is in the core c++ spec.<br><br>Since you sound like you are struggling to think of an algorithm as well:<br><br>Create a 'buffer' array to hold the old visdata and the value of the performance counter that needs to be reached when <b>N</b>ms will have passed. this buffer will need to be initialised with <b>N</b>ms of fake data<br><br>Store the frequency of the performance counter in some variable, this lets you convert the ugly LARGE_INTEGER into a number of seconds, and hence also milliseconds. This is a constant and doesnt need to be updated<br><br>Then in this order per frame:<br><br>1.) queryperformancecounter and store the value in some var<br><br>1.) store the visdata into the buffer with the necessary number. the number is the stored result above + <b>N</b>*0.001*queryperformancefrequency (which we stored already) which is a minimum value for the return value of queryperformancecounter to return after <b>N</b>ms<br><br>2.) check through the stored numbers to see which of them exceeds the current value from queryperformancecounter<br>then replace this frames visdata with the visdata from the corresponding buffer entry<br><br>3.) because of variable framerate 2.) might not always work if we throw away the oldest entry the instant we use it. so we don't discard the oldest buffer entry until the next oldest buffer entry satisfies the test in 2.)<br><br>4.) thats it!<br><br><br><br>Note: I recommended the QueryPerf... functions because they are extremely accurate, most of the other timing API functions have resolutions like 10ms, which is pretty poor for doing anything accurately in realtime. Some of them use ugly methods too, requiring callback functions or message handling.<br><br>Hope this helps.<br><br><br><br>EDIT: I would do it for you but I am at work and its not convenient to build or test here. Maybe when I get home I will come back here and take a look. It does look like it should be a trivial fix.</p></div><hr><div class="post"><p class="post-meta"><span class="post-author text-primary">Iceman_jkh</span><br></p><p class="post-time small text-muted">18th October 2006 14:45 <abbr title="Coordinated Universal Time">UTC</abbr></p><p class="post-content">Thanks Jheriko...<br><br>I read ur post and I'm getting a little (a lot) lost in the programming terms. I understand the principle, but I havent done programming since Pascal back in highschool :P. I tried to look for any hints in the Milkdrop forum (as I wanted to make a similar thing for MilkDrop), but I quickly realised that this is over my head. :(<br><br>It would be awesome if you had some time to give this a shot.. but your work definitely comes first.<br><br>EDIT: Just a thought.... Would it be possible/easier to make a plugin which loaded into winamp as a visualisation and sat between Winamp and the actual VIS. Basically, you select which actual plugin you wanna see in the settings menu in this plugin, and it just passes x millisecond delayed audio/beat data to whatever plugin you chose?<br><br>Winamp VIS = Delayer<br>Delayer[loads 'Actual Vis']<br><br>Cheers<br>Ice</p></div><hr><div class="post"><p class="post-meta"><span class="post-author text-primary">jheriko</span><br></p><p class="post-time small text-muted">19th October 2006 16:25 <abbr title="Coordinated Universal Time">UTC</abbr></p><p class="post-content">I was really tired when I got home yesterday... I will maybe try to sort something out over the weekend. The plugin idea sounds good, but I'm not exactly sure if it will be that quick to implement... I would need to make some reasonably useful UI for that.</p></div><hr><div class="post"><p class="post-meta"><span class="post-author text-primary">Iceman_jkh</span><br></p><p class="post-time small text-muted">19th October 2006 16:44 <abbr title="Coordinated Universal Time">UTC</abbr></p><p class="post-content">No problem dude. The assistance is greatly appreciated! :)<br><br>The UI could just have a box for millisecond delay, and a List box to select which VIS plugin (as per the Winamp Vis directory setting).<br><br>Could leave the "settings" part up to the main Vis window in winamp. So they do their setting up by selecting the Actual vis they want, then clicking Configure.... then switch over to the delayer plugin and select that vis within Delayer and off they go.</p></div><hr><div class="post"><p class="post-meta"><span class="post-author text-primary">jheriko</span><br></p><p class="post-time small text-muted">23rd October 2006 16:17 <abbr title="Coordinated Universal Time">UTC</abbr></p><p class="post-content">I will get around to this!<br><br>Like most of the Windows API UI coding is counter-intuitive and involves functions and constants with long, poorly descriptive names that are difficult to remember. Every time I need to make a list box or combo box I have to go and look it up again, because even with resources they managed to f*ck it up somehow. :P<br><br>You raise a good point about configuration screens and such though. It would be pretty awkward to handle nicely since the 'configure' button would need to behave specially when clicked. The simple solution would be to make the 'configure' for the delayer display some choice of which vis plugin to use before turning over to the actual plugin's configuration screen/routine.</p></div><hr><div class="post"><p class="post-meta"><span class="post-author text-primary">Iceman_jkh</span><br></p><p class="post-time small text-muted">23rd October 2006 16:33 <abbr title="Coordinated Universal Time">UTC</abbr></p><p class="post-content">Every now and then I think about trying to program this myself...and each time I open the SDK I end up 'dazed and confused'. I dont feel so bad though, as, if you are saying that its a pain in the *ss to do.. then I really had no chance of doing it. :P<br><br>Can't wait to see what you come up with.<br><br>Cheers<br>Ice</p></div><hr><div class="post"><p class="post-meta"><span class="post-author text-primary">Iceman_jkh</span><br></p><p class="post-time small text-muted">7th November 2006 08:13 <abbr title="Coordinated Universal Time">UTC</abbr></p><p class="post-content">Jheriko,<br><br>Just wondering if you've had any more time to look at this?<br><br>Cheers Mate,<br>Ice</p></div><hr><div class="post"><p class="post-meta"><span class="post-author text-primary">jheriko</span><br></p><p class="post-time small text-muted">7th November 2006 09:50 <abbr title="Coordinated Universal Time">UTC</abbr></p><p class="post-content">Yeah, in honesty I had forgot. I had devastating computer problems last weekend that sort of distracted me. I'm busy tonight but hopefully I will make a prototype later this week.</p></div><hr><div class="post"><p class="post-meta"><span class="post-author text-primary">Iceman_jkh</span><br></p><p class="post-time small text-muted">17th November 2006 01:09 <abbr title="Coordinated Universal Time">UTC</abbr></p><p class="post-content">Howd the prototype go mate?<br>Hope you managed to get all your computer stuff fixed.</p></div><hr><div class="post"><p class="post-meta"><span class="post-author text-primary">jheriko</span><br></p><p class="post-time small text-muted">17th November 2006 10:31 <abbr title="Coordinated Universal Time">UTC</abbr></p><p class="post-content">I'm criminally lazy and have still done nothing :p<br><br>Keep doing other things instead... I'll get around to it though. Sorry for being so unreliable. :p</p></div><hr><div class="post"><p class="post-meta"><span class="post-author text-primary">Iceman_jkh</span><br></p><p class="post-time small text-muted">27th November 2006 09:19 <abbr title="Coordinated Universal Time">UTC</abbr></p><p class="post-content">I hear ya!<br><br>I'm lazy too.. unless its something for my benefit... then Im super efficient :p lol.<br><br>Gimme a buzz when you get around to it.<br><br>Cheers</p></div><hr><div class="post"><p class="post-meta"><span class="post-author text-primary">Iceman_jkh</span><br></p><p class="post-time small text-muted">18th December 2006 12:51 <abbr title="Coordinated Universal Time">UTC</abbr></p><p class="post-content">Hey Jheriko,<br><br>Just giving you a nudge to let you know Im still around.<br>I know its getting to the busy part of December so I wont be holding my breath for anything till next year.<br><br>Have a good Xmas/New Year<br>Ice</p></div><hr><div class="post"><p class="post-meta"><span class="post-author text-primary">PAK-9</span><br></p><p class="post-time small text-muted">18th December 2006 13:15 <abbr title="Coordinated Universal Time">UTC</abbr></p><p class="post-content">I hate to be the one to break it to you Icey, but J is never going to get around to doing this.<br><br>This whole thread is a complex web of lies and broken promises.</p></div><hr><div class="post"><p class="post-meta"><span class="post-author text-primary">jheriko</span><br></p><p class="post-time small text-muted">18th December 2006 15:47 <abbr title="Coordinated Universal Time">UTC</abbr></p><p class="post-content">Not really, my computer is still wrecked. I need to replace the failing hard drive still... True, I could have worked on this last week maybe or the week before and it probably wouldn't have taken much effort, but at the moment I don't even have a (good) installation of Visual Studio to work with.. that and it is hard to motivate myself to do something that I don't actually want myself...<br><br>I do have a nasty habit of saying I will do something then not doing it though. I really need to stop. So I WILL make this plugin.</p></div><hr><div class="post"><p class="post-meta"><span class="post-author text-primary">PAK-9</span><br></p><p class="post-time small text-muted">18th December 2006 18:38 <abbr title="Coordinated Universal Time">UTC</abbr></p><p class="post-content"><font size="1">lies and broken promises</font></p></div><hr><div class="post"><p class="post-meta"><span class="post-author text-primary">DrO</span><br></p><p class="post-time small text-muted">18th December 2006 20:03 <abbr title="Coordinated Universal Time">UTC</abbr></p><p class="post-content"></p><blockquote><i>Originally posted by jheriko</i><br><b>I do have a nasty habit of saying I will do something then not doing it though. I really need to stop. So I WILL make this plugin.</b></blockquote>are you sure you're not me? ;)<br><br>-daz</div><hr><div class="post"><p class="post-meta"><span class="post-author text-primary">Iceman_jkh</span><br></p><p class="post-time small text-muted">20th December 2006 11:19 <abbr title="Coordinated Universal Time">UTC</abbr></p><p class="post-content"></p><blockquote><i>Originally posted by jheriko</i><br><b>So I WILL make this plugin.</b></blockquote>Heh, in any event, sounds good to me! :)</div><hr><div class="post"><p class="post-meta"><span class="post-author text-primary">Iceman_jkh</span><br></p><p class="post-time small text-muted">7th January 2007 04:24 <abbr title="Coordinated Universal Time">UTC</abbr></p><p class="post-content">Hows the plugin coming mate?</p></div><hr><div class="post"><p class="post-meta"><span class="post-author text-primary">ASD5A</span><br></p><p class="post-time small text-muted">7th January 2007 18:56 <abbr title="Coordinated Universal Time">UTC</abbr></p><p class="post-content"></p><blockquote><i>Originally posted by PAK-9</i><br><b><font size="1">lies and broken promises</font></b></blockquote></div><hr><div class="post"><p class="post-meta"><span class="post-author text-primary">Iceman_jkh</span><br></p><p class="post-time small text-muted">7th April 2007 06:38 <abbr title="Coordinated Universal Time">UTC</abbr></p><p class="post-content">Guess you guys were right! :(<br><br>Anyone else interested in reviving a plugin which can do this?<br>Ta</p></div><hr><div class="footer"><p class="text-muted small">Fork me on <a href="https://github.com/visbot/AVS-Forums/">GitHub</a></p></div></div><script type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.2.1/jquery.min.js" defer></script><script type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.3.7/js/bootstrap.min.js" defer></script><script type="text/javascript" src="../js/jquery.cookie.min.js" defer></script><script type="text/javascript" src="../js/scripts.js" defer></script></body></html>