<html xmlns="http://www.w3.org/1999/xhtml" dir="ltr" lang="en">
<head>
  <meta charset="utf-8" />
  <meta http-equiv="X-UA-Compatible" content="IE=edge" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <meta name="description" content="raytraced sine-cosine landscape using whittaker/newton-raphson" />

  <title>raytraced sine-cosine landscape using whittaker/newton-raphson - AVS Forums</title><!-- Bootstrap core CSS -->
  <link rel="stylesheet" type="text/css" href="//netdna.bootstrapcdn.com/bootswatch/3.0.2/readable/bootstrap.min.css" /><!-- HTML5 shim and Respond.js IE8 support of HTML5 elements and media queries -->
  <!--[if lt IE 9]>
                <script src="https://oss.maxcdn.com/libs/html5shiv/3.7.0/html5shiv.js"></script>
                <script src="https://oss.maxcdn.com/libs/respond.js/1.3.0/respond.min.js"></script>
        <![endif]-->
</head>

<body>
  <div class="container">
    <div class="row">
        <div class="dropdown pull-right">
          <button class="btn btn-link btn-sm dropdown-toggle" type="button" data-toggle="dropdown">
            Change style
            <span class="caret"></span>
          </button>
          <ul id="css-select" class="dropdown-menu" role="menu">
            <li><a href="#" rel="//netdna.bootstrapcdn.com/bootstrap/3.0.2/css/bootstrap.min.css">Default</a></li>
            <li role="presentation" class="divider"></li>
            <li role="presentation" class="dropdown-header">Bootswatch</li>
            <li><a href="#" rel="//netdna.bootstrapcdn.com/bootswatch/3.0.2/amelia/bootstrap.min.css">Amelia</a></li>
            <li><a href="#" rel="//netdna.bootstrapcdn.com/bootswatch/3.0.2/cerulean/bootstrap.min.css">Cerulean</a></li>
            <li><a href="#" rel="//netdna.bootstrapcdn.com/bootswatch/3.0.2/cosmo/bootstrap.min.css">Cosmo</a></li>
            <li><a href="#" rel="//netdna.bootstrapcdn.com/bootswatch/3.0.2/cyborg/bootstrap.min.css">Cyborg</a></li>
            <li><a href="#" rel="//netdna.bootstrapcdn.com/bootswatch/3.0.2/flatly/bootstrap.min.css">Flatly</a></li>
            <li><a href="#" rel="//netdna.bootstrapcdn.com/bootswatch/3.0.2/journal/bootstrap.min.css">Journal</a></li>
            <li><a href="#" rel="//netdna.bootstrapcdn.com/bootswatch/3.0.2/readable/bootstrap.min.css">Readable</a></li>
            <li><a href="#" rel="//netdna.bootstrapcdn.com/bootswatch/3.0.2/simplex/bootstrap.min.css">Simplex</a></li>
            <li><a href="#" rel="//netdna.bootstrapcdn.com/bootswatch/3.0.2/slate/bootstrap.min.css">Slate</a></li>
            <li><a href="#" rel="//netdna.bootstrapcdn.com/bootswatch/3.0.2/spacelab/bootstrap.min.css">Spacelab</a></li>
            <li><a href="#" rel="//netdna.bootstrapcdn.com/bootswatch/3.0.2/united/bootstrap.min.css">United</a></li>
            <li><a href="#" rel="//netdna.bootstrapcdn.com/bootswatch/3.0.2/yeti/bootstrap.min.css">Yeti</a></li>
          </ul>
        </div>
    </div>

    <ol class="breadcrumb">
      <li><a href="../index.html" class="glyphicon glyphicon-home"></a></li>

      <li><a href="f-137.html">AVS Presets</a></li>

      <li class="active">raytraced sine-cosine landscape using whittaker/newton-raphson</li>
    </ol>

    <p class="lead text-muted">Archive: <a title="Try the Internet Archive" target="_blank" href="http://web.archive.org/web/*/forums.winamp.com/showthread.php?t=167321">raytraced sine-cosine landscape using whittaker/newton-raphson</a></p><br />

    <div class="post">
      <p class="post-meta"><span class="post-author text-primary">your-dentist</span><br /></p>

      <p class="post-time small text-muted">30th January 2004 08:53 <abbr title="Coordinated Universal Time">UTC</abbr></p>

      <p class="post-content"><strong>raytraced sine-cosine landscape using whittaker/newton-raphson</strong><br />
      Dude!<br />
      One week ago I was still, enviously, looking at all those real-3d DMs and didn't even know what all those dx, oz and k stuff meant. Today I'm presenting my first 100% self made DM with raytracing.<br />
      It might be nothing special to all you elite math-aces out there, but to me it's special because it's the first sine-cosine landscape I've ever seen in a DM, and it's mine(sorry, but I feel so smart)! I've still got some questions about it, but I will start with the code.<br />
      I've seen the formula somewhere at school and didn't what it is, so I "took" it home.<br />
      Here it is:<br />
      z = sin(x)*cos(y)<br />
      Quite easy, but I was unable to solve it for "k" and so I tried to aproximate it. With the methods I've seen in this forum (UnConeD your'e so pow(skilled,infinite)) I even managed it.<br />
      <br />
      Here's the DM code (newton-raphson):<br />
      All checkboxes set to active.<br />
      <br />
      init:<br />
      ------<br />
      dov=4;<br />
      ------<br />
      <br />
      frame:<br />
      -----------------------------------------------------------------------<br />
      t=gettime(0);<br />
      ox=sin(t+t); oy=sin(t); oz=sin(t*.5)+5;<br />
      rx=ox*.5; ry=oy*.5; rz=oz;<br />
      sx=sin(rx); cx=cos(rx); sy=sin(ry); cy=cos(ry); sz=sin(rz); cz=cos(rz);<br />
      -----------------------------------------------------------------------<br />
      <br />
      beat:<br />
      ----------<br />
      (is empty)<br />
      ----------<br />
      <br />
      pixel:<br />
      --------------------------------------------------------------------------------------------------<br />
      dx=sin(r)*d; dy=-cos(r)*d;<br />
      dx1=dx*cz-dy*sz; dy1=dx*sz+dy*cz; dy=dy1*cx-sx; dz1=dy1*sx+cx; dx=dx1*cy-dz1*sy; dz=dx1*sy+dz1*cy;<br />
      six=sin(dx+ox); cix=cos(dy+oy);<br />
      k=k-(six*cix-dz-oz)/(-dx*cix*dy*six-dz); six=sin(dx*k+ox); cix=cos(dy*k+oy);<br />
      k=k-(six*cix-dz*k-oz)/(-dx*cix*dy*six-dz); six=sin(dx*k+ox); cix=cos(dy*k+oy);<br />
      k=k-(six*cix-dz*k-oz)/(-dx*cix*dy*six-dz); six=sin(dx*k+ox); cix=cos(dy*k+oy);<br />
      k=k-(six*cix-dz*k-oz)/(-dx*cix*dy*six-dz); six=sin(dx*k+ox); cix=cos(dy*k+oy);<br />
      k=k-(six*cix-dz*k-oz)/(-dx*cix*dy*six-dz); six=sin(dx*k+ox); cix=cos(dy*k+oy);<br />
      ix=dx*k+ox; iy=dy*k+oy; iz=dz*k+oz;<br />
      x=ix; y=iy;<br />
      alpha=dov*2-sqrt(ix*ix+iy*iy+iz*iz); alpha=if(below(alpha,0),0,if(above(alpha,1),1,alpha));<br />
      --------------------------------------------------------------------------------------------------<br />
      <br />
      As you will see, the result is quite ugly and the fogging also gets messed up. Even with twenty steps it didn't look better.<br />
      So I tried it with the whittaker method (thx to UnConeD again).<br />
      <br />
      DM code (whittaker):<br />
      All checkboxes set to active, again.<br />
      <br />
      init:<br />
      ------<br />
      dov=4;<br />
      ------<br />
      <br />
      frame:<br />
      -----------------------------------------------------------------------<br />
      t=gettime(0);<br />
      ox=sin(t+t); oy=sin(t); oz=sin(t*.5)+5;<br />
      rx=ox*.5; ry=oy*.5; rz=oz;<br />
      sx=sin(rx); cx=cos(rx); sy=sin(ry); cy=cos(ry); sz=sin(rz); cz=cos(rz);<br />
      -----------------------------------------------------------------------<br />
      <br />
      beat:<br />
      ----------<br />
      (is empty)<br />
      ----------<br />
      <br />
      pixel:<br />
      --------------------------------------------------------------------------------------------------<br />
      dx=sin(r)*d; dy=-cos(r)*d;<br />
      dx1=dx*cz-dy*sz; dy1=dx*sz+dy*cz; dy=dy1*cx-sx; dz1=dy1*sx+cx; dx=dx1*cy-dz1*sy; dz=dx1*sy+dz1*cy;<br />
      k=k+(sin(dx+ox)*cos(dy+oy)-dz-oz);<br />
      k=k+(sin(dx*k+ox)*cos(dy*k+oy)-dz*k-oz);<br />
      k=k+(sin(dx*k+ox)*cos(dy*k+oy)-dz*k-oz);<br />
      k=k+(sin(dx*k+ox)*cos(dy*k+oy)-dz*k-oz);<br />
      k=k+(sin(dx*k+ox)*cos(dy*k+oy)-dz*k-oz);<br />
      ix=dx*k+ox; iy=dy*k+oy; iz=dz*k+oz;<br />
      x=ix; y=iy;<br />
      alpha=dov*2-sqrt(ix*ix+iy*iy+iz*iz); alpha=if(below(alpha,0),0,if(above(alpha,1),1,alpha));<br />
      --------------------------------------------------------------------------------------------------<br />
      <br />
      Looks way better, hu?<br />
      <br />
      Ok, that was the code. As you might have seen (switch of blending), in the distance everything get's messed up.<br />
      So here's my first question:<br />
      Is there a way to solve the equation for "k"?<br />
      If yes, please tell me how.<br />
      I've been thinking about refraction stuff, but I've had nothing to use it on, now I have.<br />
      I'm sure I can figure out, with trying around a bit, how to do this (I know the basics). But I really have no idea of how to calculate the normal vectors of a point on that landscape (maybe I have, but I'm not sure about it, plus it's pretty late now so I don't have time to think about it), so can someone tell me how to do this?<br />
      <br />
      Well, that's it. Now it's your turn, tell me how you like the DM, or answer my questions, or do both.<br />
      Thank 'n see y'all.</p>
    </div>
    <hr />

    <div class="post">
      <p class="post-meta"><span class="post-author text-primary">UnConeD</span><br /></p>

      <p class="post-time small text-muted">30th January 2004 12:30 <abbr title="Coordinated Universal Time">UTC</abbr></p>

      <p class="post-content">Not bad at all...<br />
      <br />
      For the normal/gradient, just use (-***8706;z/***8706;x, -***8706;z/***8706;y, 1). (***8706; = partial derivative)<br />
      <br />
      Oh and my flag preset was in fact a "sine/cosine landscape" really. So you're not first, sorry :rolleyes:.<br />
      <br />
      Equations with sine are usually tricky to solve: a ray that is not to steep will have multiple intersections anyway (some rays even infinite), so you're better off doing it numerically.<br />
      <br />
      By the way, maybe you should try starting by raytracing the plane that touches the tops of the bumps: this is a good starting value for 'k' and could speed up the code and allow for higher gridsize (and less uglyness in the distance).</p>
    </div>
    <hr />

    <div class="post">
      <p class="post-meta"><span class="post-author text-primary">your-dentist</span><br /></p>

      <p class="post-time small text-muted">30th January 2004 13:33 <abbr title="Coordinated Universal Time">UTC</abbr></p>

      <p class="post-content">UnConeD:"Oh and my flag preset was in fact a "sine/cosine landscape" really. So you're not first, sorry"<br />
      Me:"Damned!"<br />
      UnConeD:"By the way, maybe you should try starting by raytracing the plane that touches the tops of the bumps"<br />
      Me:"I will try that, but my understanding of raytracing is still a bit :down: so could you please explain to me why this makes it faster."<br />
      Well, thanks for your help.<br />
      btw: I've now seen all your packs, (:mad: &lt;- want's to be you) and the final whack was just inhuman. I bet it wont take long until someone will make games using AVS. I've read about a wolfenstein preset, you've made. Can I download it somewhere?<br />
      'Nuf questions, I hope the final whack wasn't your last pack. Cya.</p>
    </div>
    <hr />

    <div class="post">
      <p class="post-meta"><span class="post-author text-primary">UnConeD</span><br /></p>

      <p class="post-time small text-muted">30th January 2004 18:40 <abbr title="Coordinated Universal Time">UTC</abbr></p>

      <p class="post-content">Why a plane would speed it up: for plain whittaker raytracing, you usually start with k=0 or some other small value.<br />
      If you start by raytracing the plane which touches the tops of the bumps, you will already be close to the intersection point, and you will probably need less iterations.<br />
      Raytracing a plane is quite fast (well compared to sines/cosine anyway).<br />
      <br />
      Depending on which side your camera is on, you'll need to raytrace z=1 or z=-1:<br /></p>
      <pre>
<code><br />    z = 1<br />&lt;=&gt; k*dz+oz = 1<br />&lt;=&gt; k = (1-oz)/dz<br /></code>
</pre><br />
      <br />
      Once you have that, you probably need less whittaker iterations. By the way, you never reset your 'k' so in fact you're iterating progressively from gridpoint to gridpoint (which might be better or worse, depending on the camera angle).<br />
      <br />
      You can get the wolfenstein preset <a href="http://www.deviantart.com/deviation/1198842/" target="_blank">here</a>, but it's just Elevation with different texturing (Elevation was derived from WolfenAVStein).
    </div>
    <hr />

    <div class="post">
      <p class="post-meta"><span class="post-author text-primary">fragmer</span><br /></p>

      <p class="post-time small text-muted">30th January 2004 20:53 <abbr title="Coordinated Universal Time">UTC</abbr></p>

      <p class="post-content">and don't forget about alpha optimiz.:<br />
      <br />
      alpha=min(1,max(0,dov*2-sqrt(ix*ix+iy*iy+iz*iz)));</p>
    </div>
    <hr />

    <div class="post">
      <p class="post-meta"><span class="post-author text-primary">UIUC85</span><br /></p>

      <p class="post-time small text-muted">31st January 2004 00:43 <abbr title="Coordinated Universal Time">UTC</abbr></p>

      <p class="post-content">Uhh where did your Whittaker constant go by the way?<br />
      <br />
      pixel:<br />
      --------------------------------------------------------------------------------------------------<br />
      dx=sin(r)*d; dy=-cos(r)*d;<br />
      dx1=dx*cz-dy*sz; dy1=dx*sz+dy*cz; dy=dy1*cx-sx; dz1=dy1*sx+cx; dx=dx1*cy-dz1*sy; dz=dx1*sy+dz1*cy;<br />
      wh=.5;<br />
      k=k+(sin(dx+ox)*cos(dy+oy)-dz-oz)*wh;<br />
      k=k+(sin(dx*k+ox)*cos(dy*k+oy)-dz*k-oz)*wh;<br />
      k=k+(sin(dx*k+ox)*cos(dy*k+oy)-dz*k-oz)*wh;<br />
      k=k+(sin(dx*k+ox)*cos(dy*k+oy)-dz*k-oz)*wh;<br />
      k=k+(sin(dx*k+ox)*cos(dy*k+oy)-dz*k-oz)*wh;<br />
      ix=dx*k+ox; iy=dy*k+oy; iz=dz*k+oz;<br />
      x=ix; y=iy;<br />
      alpha=dov*2-sqrt(ix*ix+iy*iy+iz*iz); alpha=if(below(alpha,0),0,if(above(alpha,1),1,alpha));<br />
      --------------------------------------------------------------------------------------------------<br />
      <br />
      If you add that constant you'll notice the texture on the edges doesn't distort nearly as much because it makes the approximation more exact. And yeah go with the initial plane approximation like UnConeD said. You might be interested in looking at my Adapt preset. The post should still be in this forum down on the list. That uses whittaker iteration as well. Thats another direction to take this idea.<br />
      <br />
      Oh and it kinda sounds like you haven't dealt with functions of more than one variable before... I'm all for refraction but you might come across one problem if you try and complicate the equation. If you make the equation too complicated it's gonna be a pain to get the partial derivatives (or just REALLY LONG). Just a friendly word of warning. I ran into that problem anyways...</p>
    </div>
    <hr />

    <div class="footer">
      <p class="text-muted small">Fork me on <a href="https://github.com/visbot/AVS-Forums/">GitHub</a></p>
    </div>
  </div><!-- Put JavaScript here -->
  <script type="text/javascript" src="//code.jquery.com/jquery-1.10.2.min.js"></script>
<script type="text/javascript" src="//netdna.bootstrapcdn.com/bootstrap/3.0.2/js/bootstrap.min.js"></script>
  <script type="text/javascript" src="../js/jquery.cookie.min.js"></script>
  <script type="text/javascript" src="../js/scripts.js"></script>
</body>
</html>
