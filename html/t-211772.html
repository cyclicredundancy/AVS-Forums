<html xmlns="http://www.w3.org/1999/xhtml" dir="ltr" lang="en"><head><meta charset="utf-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width,initial-scale=1"><meta name="description" content="ugly bmp-&gt;megabuf method"><title>ugly bmp-&gt;megabuf method - AVS Forums</title><script>(function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){(i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)})(window,document,'script','https://www.google-analytics.com/analytics.js','ga');ga('create','UA-53539506-7','auto');ga('send','pageview');</script><link href="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.3.7/css/bootstrap.min.css" rel="stylesheet"><!--[if lt IE 9]><script src="https://oss.maxcdn.com/libs/html5shiv/3.7.0/html5shiv.js"></script><script src="https://oss.maxcdn.com/libs/respond.js/1.3.0/respond.min.js"></script><![endif]--></head><body style="display:none"><div class="container"><div class="row"><div class="dropdown pull-right"><button class="btn btn-link btn-sm dropdown-toggle" type="button" data-toggle="dropdown">Change style <span class="caret"></span></button><ul id="css-select" class="dropdown-menu" role="menu"><li><a href="#" rel="//netdna.bootstrapcdn.com/bootstrap/3.0.2/css/bootstrap.min.css">Default</a></li><li role="presentation" class="divider"></li><li role="presentation" class="dropdown-header">Bootswatch</li><li><a href="#" rel="https://cdnjs.cloudflare.com/ajax/libs/bootswatch/3.3.7/amelia/bootstrap.min.css">Amelia</a></li><li><a href="#" rel="https://cdnjs.cloudflare.com/ajax/libs/bootswatch/3.3.7/cerulean/bootstrap.min.css">Cerulean</a></li><li><a href="#" rel="https://cdnjs.cloudflare.com/ajax/libs/bootswatch/3.3.7/cosmo/bootstrap.min.css">Cosmo</a></li><li><a href="#" rel="https://cdnjs.cloudflare.com/ajax/libs/bootswatch/3.3.7/cyborg/bootstrap.min.css">Cyborg</a></li><li><a href="#" rel="https://cdnjs.cloudflare.com/ajax/libs/bootswatch/3.3.7/flatly/bootstrap.min.css">Flatly</a></li><li><a href="#" rel="https://cdnjs.cloudflare.com/ajax/libs/bootswatch/3.3.7/journal/bootstrap.min.css">Journal</a></li><li><a href="#" rel="https://cdnjs.cloudflare.com/ajax/libs/bootswatch/3.3.7/readable/bootstrap.min.css">Readable</a></li><li><a href="#" rel="https://cdnjs.cloudflare.com/ajax/libs/bootswatch/3.3.7/simplex/bootstrap.min.css">Simplex</a></li><li><a href="#" rel="https://cdnjs.cloudflare.com/ajax/libs/bootswatch/3.3.7/slate/bootstrap.min.css">Slate</a></li><li><a href="#" rel="https://cdnjs.cloudflare.com/ajax/libs/bootswatch/3.3.7/spacelab/bootstrap.min.css">Spacelab</a></li><li><a href="#" rel="https://cdnjs.cloudflare.com/ajax/libs/bootswatch/3.3.7/united/bootstrap.min.css">United</a></li><li><a href="#" rel="https://cdnjs.cloudflare.com/ajax/libs/bootswatch/3.3.7/yeti/bootstrap.min.css">Yeti</a></li></ul></div></div><ol class="breadcrumb"><li><a href="../index.html" class="glyphicon glyphicon-home"></a></li><li><a href="f-85.html">AVS</a></li><li class="active">ugly bmp-&gt;megabuf method</li></ol><p class="lead text-muted">Archive: <a title="Try the Internet Archive" target="_blank" href="http://web.archive.org/web/*/forums.winamp.com/showthread.php?t=211772">ugly bmp-&gt;megabuf method</a></p><br><div class="post"><p class="post-meta"><span class="post-author text-primary">jheriko</span><br></p><p class="post-time small text-muted">30th March 2005 06:50 <abbr title="Coordinated Universal Time">UTC</abbr></p><p class="post-content"><strong>ugly bmp-&gt;megabuf method</strong><br>Until we get an ape for loading a bitmap straight into gmegabuf here is a 'dirty' approach. Basically the exe included in the zip will convert *some* .bmps into a .gvm containing gmegabuf assigns for the width, height and the rgb data.<br><br>I call this a dirty approach for several reasons. Firstly (and most importantly) a .gvm is a lot bigger than the bmp it came from... and we dont store any more data... actually we store a bit less. Secondly it can only handle some bitmaps as I am far too lazy to handle all the millions of special cases and know that PAK-9 is working on a much better APE solution.<br><br>24-bit square bitmaps with even number width and height are all its supposed to be able to handle.<br><br>I won't support this or promise to develop this further, I'm just posting this as I feel a bit lame for having tools for doing this stuff easily... that others may not have simply because they don't know about bitmap files or c++ or whatever...<br><br>Included is sample .gvm .bmp and .avs as well as bmpconv.exe<br><br>it gives you help if you just type bmpconv.. for those too lazy to do that it works like this:<br><br>bmpconv mybmp.bmp mygvm.gvm &lt;n&gt;<br><br>where &lt;n&gt; is the offset in the gmegabuf that the data will start. gmegabuf(offset) is the width and gmegabuf(offset+1) is the height, the rgb data is then stored after<br><br>n.b. please dont base anything off of the example preset. its horribly unoptimised and is probably buggy.</p></div><hr><div class="post"><p class="post-meta"><span class="post-author text-primary">PAK-9</span><br></p><p class="post-time small text-muted">30th March 2005 12:10 <abbr title="Coordinated Universal Time">UTC</abbr></p><p class="post-content">Since we're posting dirty tools<br><br>Converts an interleaved RGB .raw file into a series of gmegabuf assignments in a file for use with Jheriko's APE.<br><br>Like J's, quick dirty and unsupported :D</p></div><hr><div class="post"><p class="post-meta"><span class="post-author text-primary">jheriko</span><br></p><p class="post-time small text-muted">30th March 2005 12:43 <abbr title="Coordinated Universal Time">UTC</abbr></p><p class="post-content">i know i already posted one... but here is a second example (with source bitmaps) which implements a general case normal mapping.<br><br>its not particularly well commented, but the basic method is to do normal lighting i.e. light direction dot surface normal = brightness (capped between 1 and 0) with an attenuation factor got from the distance (i'll assume you can do that :P). then to apply the normal map each local normal is dot producted with the relevant components of the 'axis vectors' like (trivially in a non rotating static world) 1 0 0, 0 1 0, 0 0 1... but these may be moving and rotating (when the object the normal map is attached to moves) so you need to recalculate the 'world normal' like this since the texture only stores a 'local normal'.<br><br>anyway... look at the code.. it probably makes more sense than my crappy explanation.<br><br>note, i have found a few bugs in my ape. one that seems to caus most crashes can be totally avoided by not using more than one instance. so in this preset i stuck the two gvms together so i could load it just once into one. am working on the fix and will release asap. in this zip is a 1.01 with //$notrans for faster eeltrans.ape working togetherness and also a few minor bugfixes (typo in help gone, filename length stored correctly)<br><br><br>attachment is rar in zip cos it just fits under the max size</p></div><hr><div class="post"><p class="post-meta"><span class="post-author text-primary">TomyLobo</span><br></p><p class="post-time small text-muted">30th March 2005 14:15 <abbr title="Coordinated Universal Time">UTC</abbr></p><p class="post-content"></p><blockquote><i>Originally posted by jheriko</i><br><b>in this zip is a 1.01 with //$notrans for faster eeltrans.ape working togetherness</b></blockquote>you forgot to mention that this also needs a new eeltrans.ape, which you can get from <a href="http://tomylobo.deviantart.com" target="_blank">my deviantart page</a></div><hr><div class="post"><p class="post-meta"><span class="post-author text-primary">jheriko</span><br></p><p class="post-time small text-muted">30th March 2005 22:42 <abbr title="Coordinated Universal Time">UTC</abbr></p><p class="post-content">:)<br><br>Use eeltrans it make evallib into 'not a crap language'.<br><br>[/advert]</p></div><hr><div class="post"><p class="post-meta"><span class="post-author text-primary">ASD5A</span><br></p><p class="post-time small text-muted">14th April 2005 12:53 <abbr title="Coordinated Universal Time">UTC</abbr></p><p class="post-content">looking forward to an ape writing the actual rendered picture into megabuf.<br>That would enable relektions done with an superscope.<br>Btw. iÂ´m currently working on a superscope which has quite realistic lightning and which own shadows affect the lightning of the superscope.</p></div><hr><div class="post"><p class="post-meta"><span class="post-author text-primary">TomyLobo</span><br></p><p class="post-time small text-muted">17th April 2005 05:30 <abbr title="Coordinated Universal Time">UTC</abbr></p><p class="post-content">you mean reflections? those'll be dead slow<br>self-shadowing... sounds interesting<br>why not use triangles though? :)<br>they're faster and look much more solid</p></div><hr><div class="post"><p class="post-meta"><span class="post-author text-primary">ASD5A</span><br></p><p class="post-time small text-muted">17th April 2005 09:53 <abbr title="Coordinated Universal Time">UTC</abbr></p><p class="post-content">yes i mean reflections but only one-level reflections(direkt to enviroment).<br>my code will support the triangle-idea, which will sure speed up the whole thing.<br>but unfortunally the global var manager seems not to work for me.</p></div><hr><div class="post"><p class="post-meta"><span class="post-author text-primary">^..^</span><br></p><p class="post-time small text-muted">17th April 2005 11:18 <abbr title="Coordinated Universal Time">UTC</abbr></p><p class="post-content">jheriko just recently released a new version of his globmgr.ape in <a href="http://web.archive.org/web/*/forums.winamp.com/showthread.php?s=&amp;threadid=213336." target="_blank">another thread</a>. Perhaps it will work for you now?!</p></div><hr><div class="post"><p class="post-meta"><span class="post-author text-primary">ASD5A</span><br></p><p class="post-time small text-muted">17th April 2005 13:43 <abbr title="Coordinated Universal Time">UTC</abbr></p><p class="post-content">thanks ^..^ !<br>aus deutschland?<br>texturing done! :)</p></div><hr><div class="post"><p class="post-meta"><span class="post-author text-primary">^..^</span><br></p><p class="post-time small text-muted">17th April 2005 14:12 <abbr title="Coordinated Universal Time">UTC</abbr></p><p class="post-content">jau bin ich! wie kommst du darauf?</p></div><hr><div class="post"><p class="post-meta"><span class="post-author text-primary">jheriko</span><br></p><p class="post-time small text-muted">17th April 2005 22:07 <abbr title="Coordinated Universal Time">UTC</abbr></p><p class="post-content">storing the current framebuffer into the megabuf would probably be quite slow. as there is no direct access you would need to recompile and execute a huge block of code every frame. notice how long a large load takes for instance.<br><br>btw, doing shadows using a megabuf texture on triangles and raytraces is feasable (for small scenes or in very low quality if you like real time). i'm currently working on getting the obj data and bmp data to work together so that i can start making some nicely shadowed, normal spec and gloss mapped presets using some complex models. but i'm lazy and its taking ages.<br><br>good luck with making that preset.</p></div><hr><div class="post"><p class="post-meta"><span class="post-author text-primary">PAK-9</span><br></p><p class="post-time small text-muted">18th April 2005 13:20 <abbr title="Coordinated Universal Time">UTC</abbr></p><p class="post-content">The problem with shadowing is speed, if you take the raytrace method. Jheriko and I had a discussion about it over the phone, personally I think its only really practical if you reverse it and do a sort of 'shadow volumes' approach, i.e. just fire rays through the vertices of the shadowed object and use a few triangles to represent the shadow.<br><br>Its more complex to implement but faster because your doing less raytracing and just rendering a few triangles for the shadow. If you imagine casting a shadow from a triangle to a plane for example its just three ray-plane intersections and rendering a single triangle for the shadow, pretty cheap.</p></div><hr><div class="post"><p class="post-meta"><span class="post-author text-primary">jheriko</span><br></p><p class="post-time small text-muted">18th April 2005 16:10 <abbr title="Coordinated Universal Time">UTC</abbr></p><p class="post-content">one thing to note is that its impossible to do 'real' shadows this way, since instead of blocking lighting you are just rendering a black blob... which isn't what a shadow is. for the simpler case of one light source though it would be indistinguishable, for two or three light sources i suspect it would start looking really crappy though.</p></div><hr><div class="post"><p class="post-meta"><span class="post-author text-primary">ASD5A</span><br></p><p class="post-time small text-muted">18th April 2005 17:53 <abbr title="Coordinated Universal Time">UTC</abbr></p><p class="post-content">pakÂ´s idea isnÂ´t that wrong.<br>u can make the efort to influence the shadowblobs with the other light sources.<br>but shadowing on non environment needs raytracing.<br>jheriko: i think before 2006 :(<br>quite realistic shadowing wonÂ´t be done with more than 1 light source(speed).<br>one level reflections are alot faster than realshadowing.<br>two level reflections will be as slow as realshadowing with maximum geometric detail.<br><br>so keep fighting the code<br>:up:</p></div><hr><div class="post"><p class="post-meta"><span class="post-author text-primary">PAK-9</span><br></p><p class="post-time small text-muted">18th April 2005 18:11 <abbr title="Coordinated Universal Time">UTC</abbr></p><p class="post-content"></p><blockquote><i>Originally posted by jheriko</i><br><b>one thing to note is that its impossible to do 'real' shadows this way, since instead of blocking lighting you are just rendering a black blob... which isn't what a shadow is. for the simpler case of one light source though it would be indistinguishable, for two or three light sources i suspect it would start looking really crappy though.</b></blockquote>Well thats when the advantages of AVS come in, because you can render the shadow using 50/50 blend or some other blend mode for a nice fake translucency effect.</div><hr><div class="post"><p class="post-meta"><span class="post-author text-primary">jheriko</span><br></p><p class="post-time small text-muted">18th April 2005 18:45 <abbr title="Coordinated Universal Time">UTC</abbr></p><p class="post-content">btw, realistic shadowing with more than one light source will be done before 2006. ;)<br><br>i understand that you can fake the translucency etc but once you have more than one light source it looks very unnatural, especially to lamers like me who spend so much time making lighting 'demos' that every error glares out.<br><br>i dont know how you could make a true reflection consistently faster than a true shadow in all cases (especially the simpler ones we are more likely to use), since the number of raytraces for a reflection of any level is a minimum of two per point per triangle per reflective triangle, where as for a shadow it is a maximum of one per point per triangle per triangle per light. So what I'm saying is that with two or three lights a true shadowing algorithm could well be faster than a true reflection algorithm on the same scene if all faces are reflective.<br><br>The speed advantage of reflection, I suppose, would be that you don't always have to have a reflective surface where as every triangle will need to cast a shadow.<br><br>Plus its not computationally expensive to make these shadows soft rather than hard, in fact its pretty close to being free. this is because if you use the standard-ish 'sum of angles = 360' method to check if a point is in a polygon and use the same value and other code path to determine how far from the polygon it is if it isn't.<br><br>I'm not saying its a particularly efficient, but it is quite plausable.</p></div><hr><div class="post"><p class="post-meta"><span class="post-author text-primary">ASD5A</span><br></p><p class="post-time small text-muted">18th April 2005 18:59 <abbr title="Coordinated Universal Time">UTC</abbr></p><p class="post-content">the reason why i think onelevelreflections are a lot faster<br>is that for shadowing u must check if the point is in a shadow ray.<br>for reflections we assume the camera ray is hitting every point we see.<br>so we take the vector from the camera to the point where calculation transform the vector with the normal of that point and calculate where the ray hits the environment.<br>two level reflections must here check if it hits non enviroment and then transform the vector agian with the normal of that point.<br>the shadow check must be done (displayed points of polygon)*(number of points of geometry doubles);</p></div><hr><div class="post"><p class="post-meta"><span class="post-author text-primary">ASD5A</span><br></p><p class="post-time small text-muted">18th April 2005 19:25 <abbr title="Coordinated Universal Time">UTC</abbr></p><p class="post-content">iÂ´ve reread jherikos last post.<br>and have a bit to add to my last post.<br>onelevelreflections do need lightned environment( which is done fast) for realistic purpose. and a reflection raytrace is faster done as an shadowing one.(for refl. ca.10 algorithms).</p></div><hr><div class="post"><p class="post-meta"><span class="post-author text-primary">PAK-9</span><br></p><p class="post-time small text-muted">18th April 2005 20:12 <abbr title="Coordinated Universal Time">UTC</abbr></p><p class="post-content">Note that the method I suggested is also produces higher resolution shadows because you arent limited by the 'pixels' in your 'texture', which lets be honest is pretty low</p></div><hr><div class="post"><p class="post-meta"><span class="post-author text-primary">jheriko</span><br></p><p class="post-time small text-muted">18th April 2005 20:38 <abbr title="Coordinated Universal Time">UTC</abbr></p><p class="post-content">what i was trying to get at asd5a is that for a reflection you trace from the camera to some point checking for a collision so we know when the reflection is blocked then reflect the ray and see what it hits in the world. for a shadow all i need to do is raytrace from the light to the point and see if it collides, which is the first step of the reflection algorithm. my reflection algorithm could be a crap one though... the assumption i made is that it isn't. i also assume that you are using triangles or quads that are subdivided, or some superscope parallel which would operate similarly rather than a dm, which works very differently and reflection would indeed be a lot more practical.</p></div><hr><div class="post"><p class="post-meta"><span class="post-author text-primary">ASD5A</span><br></p><p class="post-time small text-muted">19th April 2005 07:21 <abbr title="Coordinated Universal Time">UTC</abbr></p><p class="post-content">for onelevelreflections(after reflection the ray definitly hits only environment(environment:i.e the cube,which isnÂ´t reflective your things are flying in)) we donÂ´t have to check if the ray from the camera is blocked we assume that every nonenvironmentsurfacepoint that is facing towards us<br>is reflecting.after the transformation of the rayvector i directly check where it hits the environmental cube.<br>jheriko your are (some kind of) wrong the first check isnÂ´t necessary.</p></div><hr><div class="post"><p class="post-meta"><span class="post-author text-primary">jheriko</span><br></p><p class="post-time small text-muted">19th April 2005 17:31 <abbr title="Coordinated Universal Time">UTC</abbr></p><p class="post-content">well it depends on how you implement it. the first check isnt required but why reflect a point when you wont be able to see the reflection? i just thought that would be optimal.<br><br>btw that torus thing i said in another thread is wrong, you need to use the central circles normals to do the first split rather than depth. jaak just pointed this out to me and i realised the error. silly as i have done exactly that in other presets :P</p></div><hr><div class="post"><p class="post-meta"><span class="post-author text-primary">ASD5A</span><br></p><p class="post-time small text-muted">19th April 2005 19:01 <abbr title="Coordinated Universal Time">UTC</abbr></p><p class="post-content">that torus prob is solved.<br>well i want to implement reflections into that torus preset and itÂ´s a pity that havent learned yet how to raytrace the inner side of an cube in andm.you could maybe raytrace a cube with egdelenght 2 and distance 2 from the camera, please.</p></div><hr><div class="post"><p class="post-meta"><span class="post-author text-primary">jheriko</span><br></p><p class="post-time small text-muted">20th April 2005 05:58 <abbr title="Coordinated Universal Time">UTC</abbr></p><p class="post-content">can't raytrace a cube?<br><br>there are lots of threads and forums topics dealing with raytracing.<br><br>as well as google etc..</p></div><hr><div class="footer"><p class="text-muted small">Fork me on <a href="https://github.com/visbot/AVS-Forums/">GitHub</a></p></div></div><script type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.2.1/jquery.min.js"></script><script type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.3.7/js/bootstrap.min.js"></script><script type="text/javascript" src="../js/jquery.cookie.min.js"></script><script type="text/javascript" src="../js/scripts.js"></script></body></html>