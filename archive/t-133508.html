<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" dir="ltr" lang="en">
<head>
	<meta charset="utf-8">
	<meta http-equiv="X-UA-Compatible" content="IE=edge">
	<meta name="viewport" content="width=device-width, initial-scale=1.0">    <!-- Bootstrap core CSS -->
	<meta name="keywords" content=" Blur convolution equivalents, avs, advanced visualization studio, wvs, winamp visualization studio" />
	<meta name="description" content=" Blur convolution equivalents AVS" />
	
	<title> Blur convolution equivalents - Winamp Forums</title>

    <!-- Bootstrap core CSS -->
    <link rel="stylesheet" type="text/css" href="//netdna.bootstrapcdn.com/bootswatch/3.0.1/readable/bootstrap.min.css" />

    <!-- HTML5 shim and Respond.js IE8 support of HTML5 elements and media queries -->
    <!--[if lt IE 9]>
      <script src="https://oss.maxcdn.com/libs/html5shiv/3.7.0/html5shiv.js"></script>
      <script src="https://oss.maxcdn.com/libs/respond.js/1.3.0/respond.min.js"></script>
    <![endif]-->
</head>
<body>

<div class="container">
<ol class="breadcrumb">
  <li><a href="../index.html" class="glyphicon glyphicon-home"></a></li>
  <li><a href="f-85.html">AVS</a></li>
  <li class="active">Blur convolution equivalents</li>
</ol>
<!-- div class="pda"><a href="t-133508.html?login=1" rel="nofollow">Log in</a></div -->
<p class="lead text-muted">Archive: <a title="Try the Wayback Machine" target="_blank" href="http://web.archive.org/web/*/http://forums.winamp.com/showthread.php?t=133508">Blur convolution equivalents</a></p>
<hr />

<div class="post"><div class="posttop"><div class="username text-primary">UnConeD</div><div class="date small text-muted">28th April 2003, 17:10</div></div>
<br />
<div class="posttext">Here are the convolution matrices that correspond to the standard blur modes. The standard blur is actually pretty bad, with tons of roundoff errors causing a soft fadeout (which convo doesn't have afaik).<br />
<br />
Each kernel is followed by a simplified, non-fading, faster version. The simplified version is done by rounding each value up to the nearest power of two and dividing until no common divisors exist.<br />
<br />
You can find these by putting a single white dotscope followed by a blur (with 'clear every frame' on of course) and taking a screenshot. AVS itself probably uses a combination of bitshifts and additions (so it does use powers of two), but because it bitshifts before adding, precision is lost and the image fades.<br />
<br />
The 3x3 matrix is of course centered in convo-ape's 7x7, with zeroes in the other positions.<br />
<br />
Light:<br />
  0  15   0           0   1   0<br />
 15 187  15     -  1  12   1<br />
  0  15   0           0   1   0<br />
div: 255             div: 16<br />
bias: 0              bias: 0<br />
<br />
<br />
Medium:<br />
  0  31   0           0   1   0<br />
 31 125  31     -  1   4   1<br />
  0  31   0           0   1   0<br />
div: 255             div: 8<br />
bias: 0              bias: 0<br />
<br />
<br />
Heavy:<br />
  0  62   0           0   1   0<br />
 62   0  62     -  1   0   1<br />
  0  62   0           0   1   0<br />
div: 255             div: 4<br />
bias: 0              bias: 0<br />
<br />
<br />
Example of roundoff error:<br />
<br />
Blend 50/50 rgb(255,255,255) with itself should logically result in rgb(255,255,255).<br />
<br />
Bad: Bitshift/divide, then add:<br />
255 / 2 = 127 (integer math only!)<br />
127 + 127 = 254 (faded out!)<br />
<br />
Good: Add, then bitshift/divide:<br />
<br />
255 + 255 = 510<br />
510 / 2 = 255<br />
<br />
<br />
The reason AVS does this is probably because the blur doesn't use MMX, and so it works with the entire RGB color rather than unpacking and handling each channel separately (which is unbearably slow without MMX). When you work with the entire channel, you cannot use the good-method, because then the channels' bits would overlap.<br />
<br />
APE authors: the 'lovely helper functions' inside the APE SDK header also contains bad, non-MMX versions of the blending functions. In this case, using convolution might in fact always be faster.</div></div><hr />


<div class="post"><div class="posttop"><div class="username text-primary">dirkdeftly</div><div class="date small text-muted">28th April 2003, 17:18</div></div>
<br />
<div class="posttext">unconed strikes again ;)<br />
/me plans on testing this this afternoon...</div></div><hr />


<div class="post"><div class="posttop"><div class="username text-primary">Jaak</div><div class="date small text-muted">28th April 2003, 18:50</div></div>
<br />
<div class="posttext">Thanks UnConeD...</div></div><hr />


<div class="post"><div class="posttop"><div class="username text-primary">jheriko</div><div class="date small text-muted">28th April 2003, 19:03</div></div>
<br />
<div class="posttext">31? 125? 255? 62??? Does nullsoft understand the concept of 'power of 2' and how much faster it makes multiplication (i.e. bit shifting).<br />
<br />
It is possible that in my blind envy of nullsoft's mad coding skillz that I might be ignoring the fact that the blurs probably don't use the actual convolution method....</div></div><hr />


<div class="post"><div class="posttop"><div class="username text-primary">dirkdeftly</div><div class="date small text-muted">28th April 2003, 19:55</div></div>
<br />
<div class="posttext">i think unconed meant 127 and 63, which are 2^n-1 (because it starts from 0), which works for bitshifting, no?</div></div><hr />


<div class="post"><div class="posttop"><div class="username text-primary">anubis2003</div><div class="date small text-muted">28th April 2003, 22:15</div></div>
<br />
<div class="posttext">I dunno for sure Atero, but those numbers do seem really weird.</div></div><hr />


<div class="post"><div class="posttop"><div class="username text-primary">UnConeD</div><div class="date small text-muted">28th April 2003, 22:51</div></div>
<br />
<div class="posttext">Um, did you guys READ the text? These are the resultant values, after round-off. To get the exact same behaviour in convolution, you need to use these values, because convolution does not have roundoff errors.<br />
<br />
AVS does use the optimized version on the righthand (ie powers of two) internally, but it comes out as the values on the left.</div></div><hr />


<div class="post"><div class="posttop"><div class="username text-primary">shreyas_potnis</div><div class="date small text-muted">29th April 2003, 10:48</div></div>
<br />
<div class="posttext">after long discussions about MMX with UnConeD, i still dont know how to work with it :(, anyway, can you post this in the tips and tricks folder too?</div></div><hr />
<div class="footer">
	<p class="text-muted small">Fork me on <a href="https://github.com/visbot/AVS-Forums/">GitHub</a></p>
</div>
</div>

</body>
</html>