<html xmlns="http://www.w3.org/1999/xhtml" dir="ltr" lang="en">
<head>
  <meta charset="utf-8" />
  <meta http-equiv="X-UA-Compatible" content="IE=edge" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <meta name="description" content="APE Megabuf assignment" />

  <title>APE Megabuf assignment - AVS Forums</title><!-- Bootstrap core CSS -->
  <link rel="stylesheet" type="text/css" href="//netdna.bootstrapcdn.com/bootswatch/3.0.1/readable/bootstrap.min.css" /><!-- HTML5 shim and Respond.js IE8 support of HTML5 elements and media queries -->
  <!--[if lt IE 9]>
                <script src="https://oss.maxcdn.com/libs/html5shiv/3.7.0/html5shiv.js"></script>
                <script src="https://oss.maxcdn.com/libs/respond.js/1.3.0/respond.min.js"></script>
        <![endif]-->
</head>

<body>
  <div class="container">
    <!-- Put navigation bar here -->

    <ol class="breadcrumb">
      <li><a href="../index.html" class="glyphicon glyphicon-home"></a></li>

      <li><a href="f-85.html">AVS</a></li>

      <li class="active">APE Megabuf assignment</li>
    </ol>

    <p class="lead text-muted">Archive: <a title="Try the Internet Archive" target="_blank" href="http://web.archive.org/web/*/forums.winamp.com/showthread.php?t=210015">APE Megabuf assignment</a></p><br />

    <div class="post">
      <p class="post-meta"><span class="post-author text-primary">PAK-9</span><br />
      <p class="post-time small text-muted">10th March 2005 10:53 <abbr title="Coordinated Universal Time<abbr title="Coordinated Universal Time">UTC</abbr></p></p>

      <p class="post-content"><strong>APE Megabuf assignment</strong><br />
      Does anyone know if there is a way to write directly to the megabuf in an APE? I want to assign thousands of megabuf items so compiling assignment code isnt really an option. If I could just get the address of the start of the megabuf or something... any ideas?</p>
    </div>
    <hr />

    <div class="post">
      <p class="post-meta"><span class="post-author text-primary">PAK-9</span><br />
      <p class="post-time small text-muted">16th March 2005 18:33 <abbr title="Coordinated Universal Time<abbr title="Coordinated Universal Time">UTC</abbr></p></p>

      <p class="post-content">Geez thanks for the input guys</p>
    </div>
    <hr />

    <div class="post">
      <p class="post-meta"><span class="post-author text-primary">hboy</span><br />
      <p class="post-time small text-muted">16th March 2005 20:24 <abbr title="Coordinated Universal Time<abbr title="Coordinated Universal Time">UTC</abbr></p></p>

      <p class="post-content">dunno. :D</p>
    </div>
    <hr />

    <div class="post">
      <p class="post-meta"><span class="post-author text-primary">Tuggummi</span><br />
      <p class="post-time small text-muted">16th March 2005 20:56 <abbr title="Coordinated Universal Time<abbr title="Coordinated Universal Time">UTC</abbr></p></p>

      <p class="post-content"><strong>Re: APE Megabuf assignment</strong><br /></p>

      <blockquote>
        <i>Originally posted by PAK-9</i><br />
        <b>If I could just get the address of the megabuf</b>
      </blockquote>Sure, it's:<br />
      <pre>
<code><font size="3">Mr.Buf Mega<br />1337 SDK-Road<br />AmpLand</font><br /></code>
</pre>
    </div>
    <hr />

    <div class="post">
      <p class="post-meta"><span class="post-author text-primary">PAK-9</span><br />
      <p class="post-time small text-muted">17th March 2005 14:29 <abbr title="Coordinated Universal Time<abbr title="Coordinated Universal Time">UTC</abbr></p></p>

      <p class="post-content">omg thx!!1!one</p>
    </div>
    <hr />

    <div class="post">
      <p class="post-meta"><span class="post-author text-primary">Warrior of the Light</span><br />
      <p class="post-time small text-muted">17th March 2005 14:32 <abbr title="Coordinated Universal Time<abbr title="Coordinated Universal Time">UTC</abbr></p></p>

      <p class="post-content"><strong>Re: APE Megabuf assignment</strong><br /></p>

      <blockquote>
        <i>Originally posted by PAK-9</i><br />
        <b>Does anyone know if there is a way to write directly to the megabuf in an APE?</b>
      </blockquote>I guess there isn't anyone then..
    </div>
    <hr />

    <div class="post">
      <p class="post-meta"><span class="post-author text-primary">S-uper_T-oast</span><br />
      <p class="post-time small text-muted">17th March 2005 16:53 <abbr title="Coordinated Universal Time<abbr title="Coordinated Universal Time">UTC</abbr></p></p>

      <p class="post-content">I don't see why it wouldn't be possible to do, but I don't know how.</p>
    </div>
    <hr />

    <div class="post">
      <p class="post-meta"><span class="post-author text-primary">MaTTFURY</span><br />
      <p class="post-time small text-muted">17th March 2005 23:54 <abbr title="Coordinated Universal Time<abbr title="Coordinated Universal Time">UTC</abbr></p></p>

      <p class="post-content">ask jaak or unconed or tomylobo :p</p>
    </div>
    <hr />

    <div class="post">
      <p class="post-meta"><span class="post-author text-primary">TomyLobo</span><br />
      <p class="post-time small text-muted">18th March 2005 03:59 <abbr title="Coordinated Universal Time<abbr title="Coordinated Universal Time">UTC</abbr></p></p>

      <p class="post-content">there might be one... it will require a bit of reverse engineering though.<br />
      i started with that but have given up at some point. here's what i have:<br />
      <br />
      this little code snippet will give you the address of the megabuf function:<br /></p>
      <pre>
<code><br />VM_CONTEXT      vmc = g_extinfo-&gt;allocVM();<br />compileContext  *ctx = (compileContext *)vmc;<br />VM_CODEHANDLE   cod = g_extinfo-&gt;compileVMcode(vmc, "gmegabuf(0)");<br />codeHandleType  *ch = (codeHandleType *)cod;<br />char *output = new char[1024];<br />memset(output,0,1024);<br /><br />void *foo = *((void **)(((unsigned char *)ch-&gt;code)+25));<br />static double * (NSEEL_CGEN_CALL *__megabuf)(double ***,double *);<br />__asm {<br />    mov eax,foo<br />    mov __megabuf,eax<br />}<br />void (*blub)(void) = (void (*)(void))(ch-&gt;code);<br />//blub();<br />sprintf(output,"%X",__megabuf);<br />MessageBox(NULL, output, "debug output", 0);<br />delete[] output;<br />g_extinfo-&gt;freeCode(cod);<br />g_extinfo-&gt;freeVM(vmc);<br /></code>
</pre><br />
      you also need to put that struct somewhere:<br />
      <br />
      <pre>
<code><br />#define YYSTYPE int<br /><br />typedef struct<br />{<br />  double **varTable_Values;<br />  char   **varTable_Names;<br />  int varTable_numBlocks;<br /><br />  int errVar;<br />  int colCount;<br />  int result;<br />  char last_error_string[256];<br />  YYSTYPE yylval;<br />  int   yychar;                 /*  the lookahead symbol                */<br />  int yynerrs;                  /*  number of parse errors so far       */<br />  char yytext[256];<br />  char lastVar[256];<br /><br />  char    *llsave[16];             /* Look ahead buffer            */<br />  char    llbuf[100];             /* work buffer                          */<br />  char    *llp1;//   = &amp;llbuf[0];    /* pointer to next avail. in token      */<br />  char    *llp2;//   = &amp;llbuf[0];    /* pointer to end of lookahead          */<br />  char    *llend;//  = &amp;llbuf[0];    /* pointer to end of token              */<br />  char    *llebuf;// = &amp;llbuf[sizeof llbuf];<br />  int     lleof;<br />  int     yyline;//  = 0;<br /><br />  void *tmpblocks_head,*blocks_head;<br />  int computTableTop; // make it abort on potential overflow =)<br />  int l_stats[4]; // source bytes, static code bytes, call code bytes, data bytes<br /><br />  void *userfunc_data[64];<br />}<br />compileContext;<br /><br />#define LLB_DSIZE (65536-64)<br />typedef struct _llBlock {<br />        struct _llBlock *next;<br />  int sizeused;<br />        char block[LLB_DSIZE];<br />} llBlock;<br /><br />typedef struct {<br />  int workTablePtr_size;<br /><br />  llBlock *blocks;<br />  void *code;<br />  int code_stats[4];<br />} codeHandleType;<br /><br />#define NSEEL_CGEN_CALL __fastcall<br /></code>
</pre><br />
      you can also find that in the nseel folder of the winamp SDK. better get it from there :)
    </div>
    <hr />

    <div class="post">
      <p class="post-meta"><span class="post-author text-primary">PAK-9</span><br />
      <p class="post-time small text-muted">18th March 2005 16:31 <abbr title="Coordinated Universal Time<abbr title="Coordinated Universal Time">UTC</abbr></p></p>

      <p class="post-content">Well the address of the megabuf function is as good a starting point as any, thanks</p>
    </div>
    <hr />

    <div class="footer">
      <p class="text-muted small">Fork me on <a href="https://github.com/visbot/AVS-Forums/">GitHub</a></p>
    </div>
  </div><!-- Put JavaScript here -->
</body>
</html>
