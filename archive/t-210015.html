<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" dir="ltr" lang="en">
<head>
	<meta charset="utf-8">
	<meta http-equiv="X-UA-Compatible" content="IE=edge">
	<meta name="viewport" content="width=device-width, initial-scale=1.0">    <!-- Bootstrap core CSS -->
	<meta name="keywords" content=" APE Megabuf assignment, avs, advanced visualization studio, wvs, winamp visualization studio" />
	<meta name="description" content=" APE Megabuf assignment AVS" />
	
	<title> APE Megabuf assignment - Winamp Forums</title>

    <!-- Bootstrap core CSS -->
    <link rel="stylesheet" type="text/css" href="//netdna.bootstrapcdn.com/bootswatch/3.0.1/readable/bootstrap.min.css" />

    <!-- HTML5 shim and Respond.js IE8 support of HTML5 elements and media queries -->
    <!--[if lt IE 9]>
      <script src="https://oss.maxcdn.com/libs/html5shiv/3.7.0/html5shiv.js"></script>
      <script src="https://oss.maxcdn.com/libs/respond.js/1.3.0/respond.min.js"></script>
    <![endif]-->
</head>
<body>

<div class="container">
<ol class="breadcrumb">
  <li><a href="../index.html" class="glyphicon glyphicon-home"></a></li>
  <li><a href="f-85.html">AVS</a></li>
  <li class="active">APE Megabuf assignment</li>
</ol>
<!-- div class="pda"><a href="t-210015.html?login=1" rel="nofollow">Log in</a></div -->
<p class="lead text-muted">Archive: <a title="Try the Wayback Machine" target="_blank" href="http://web.archive.org/web/*/http://forums.winamp.com/showthread.php?t=210015">APE Megabuf assignment</a></p>
<hr />

<div class="post"><div class="posttop"><div class="username text-primary">PAK-9</div><div class="date small text-muted">10th March 2005, 10:53</div></div>
<br />
<div class="posttext">Does anyone know if there is a way to write directly to the megabuf in an APE? I want to assign thousands of megabuf items so compiling assignment code isnt really an option. If I could just get the address of the start of the megabuf or something... any ideas?</div></div><hr />


<div class="post"><div class="posttop"><div class="username text-primary">PAK-9</div><div class="date small text-muted">16th March 2005, 18:33</div></div>
<br />
<div class="posttext">Geez thanks for the input guys</div></div><hr />


<div class="post"><div class="posttop"><div class="username text-primary">hboy</div><div class="date small text-muted">16th March 2005, 20:24</div></div>
<br />
<div class="posttext">dunno. :D</div></div><hr />


<div class="post"><div class="posttop"><div class="username text-primary">Tuggummi</div><div class="date small text-muted">16th March 2005, 20:56</div></div>
<br />
<div class="posttext">Originally posted by PAK-9 <br />
If I could just get the address of the megabuf<br />
<br />
Sure, it's:<br />
Mr.Buf Mega<br />
1337 SDK-Road<br />
AmpLand</div></div><hr />


<div class="post"><div class="posttop"><div class="username text-primary">PAK-9</div><div class="date small text-muted">17th March 2005, 14:29</div></div>
<br />
<div class="posttext">omg thx!!1!one</div></div><hr />


<div class="post"><div class="posttop"><div class="username text-primary">Warrior of the Light</div><div class="date small text-muted">17th March 2005, 14:32</div></div>
<br />
<div class="posttext">Originally posted by PAK-9 <br />
Does anyone know if there is a way to write directly to the megabuf in an APE?  <br />
<br />
I guess there isn't anyone then..</div></div><hr />


<div class="post"><div class="posttop"><div class="username text-primary">S-uper_T-oast</div><div class="date small text-muted">17th March 2005, 16:53</div></div>
<br />
<div class="posttext">I don't see why it wouldn't be possible to do, but I don't know how.</div></div><hr />


<div class="post"><div class="posttop"><div class="username text-primary">MaTTFURY</div><div class="date small text-muted">17th March 2005, 23:54</div></div>
<br />
<div class="posttext">ask jaak or unconed or tomylobo :p</div></div><hr />


<div class="post"><div class="posttop"><div class="username text-primary">TomyLobo</div><div class="date small text-muted">18th March 2005, 03:59</div></div>
<br />
<div class="posttext">there might be one... it will require a bit of reverse engineering though.<br />
i started with that but have given up at some point. here's what i have:<br />
<br />
this little code snippet will give you the address of the megabuf function:<br />
<br />
VM_CONTEXT      vmc = g_extinfo-&gt;allocVM();<br />
compileContext  *ctx = (compileContext *)vmc;<br />
VM_CODEHANDLE   cod = g_extinfo-&gt;compileVMcode(vmc, &quot;gmegabuf(0)&quot;);<br />
codeHandleType  *ch = (codeHandleType *)cod;<br />
char *output = new char[1024];<br />
memset(output,0,1024);<br />
<br />
void *foo = *((void **)(((unsigned char *)ch-&gt;code)+25));<br />
static double * (NSEEL_CGEN_CALL *__megabuf)(double ***,double *);<br />
__asm {<br />
    mov eax,foo<br />
    mov __megabuf,eax<br />
}<br />
void (*blub)(void) = (void (*)(void))(ch-&gt;code);<br />
//blub();<br />
sprintf(output,&quot;%X&quot;,__megabuf);<br />
MessageBox(NULL, output, &quot;debug output&quot;, 0);<br />
delete[] output;<br />
g_extinfo-&gt;freeCode(cod);<br />
g_extinfo-&gt;freeVM(vmc);<br />
<br />
you also need to put that struct somewhere:<br />
<br />
<br />
#define YYSTYPE int<br />
<br />
typedef struct<br />
{<br />
  double **varTable_Values;<br />
  char   **varTable_Names;<br />
  int varTable_numBlocks;<br />
<br />
  int errVar;<br />
  int colCount;<br />
  int result;<br />
  char last_error_string[256];<br />
  YYSTYPE yylval;<br />
  int	yychar;			/*  the lookahead symbol		*/<br />
  int yynerrs;			/*  number of parse errors so far       */<br />
  char yytext[256];<br />
  char lastVar[256];<br />
<br />
  char    *llsave[16];             /* Look ahead buffer            */<br />
  char    llbuf[100];             /* work buffer                          */<br />
  char    *llp1;//   = &amp;llbuf[0];    /* pointer to next avail. in token      */<br />
  char    *llp2;//   = &amp;llbuf[0];    /* pointer to end of lookahead          */<br />
  char    *llend;//  = &amp;llbuf[0];    /* pointer to end of token              */<br />
  char    *llebuf;// = &amp;llbuf[sizeof llbuf];<br />
  int     lleof;<br />
  int     yyline;//  = 0;<br />
<br />
  void *tmpblocks_head,*blocks_head;<br />
  int computTableTop; // make it abort on potential overflow =)<br />
  int l_stats[4]; // source bytes, static code bytes, call code bytes, data bytes<br />
<br />
  void *userfunc_data[64];<br />
}<br />
compileContext;<br />
<br />
#define LLB_DSIZE (65536-64)<br />
typedef struct _llBlock {<br />
	struct _llBlock *next;<br />
  int sizeused;<br />
	char block[LLB_DSIZE];<br />
} llBlock;<br />
<br />
typedef struct {<br />
  int workTablePtr_size;<br />
<br />
  llBlock *blocks;<br />
  void *code;<br />
  int code_stats[4];<br />
} codeHandleType;<br />
<br />
#define NSEEL_CGEN_CALL __fastcall<br />
<br />
you can also find that in the nseel folder of the winamp SDK. better get it from there :)</div></div><hr />


<div class="post"><div class="posttop"><div class="username text-primary">PAK-9</div><div class="date small text-muted">18th March 2005, 16:31</div></div>
<br />
<div class="posttext">Well the address of the megabuf function is as good a starting point as any, thanks</div></div><hr />
<div class="footer">
	<p class="text-muted small">Fork me on <a href="https://github.com/visbot/AVS-Forums/">GitHub</a></p>
</div>
</div>

</body>
</html>