<html xmlns="http://www.w3.org/1999/xhtml" dir="ltr" lang="en">
<head>
  <meta charset="utf-8" />
  <meta http-equiv="X-UA-Compatible" content="IE=edge" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <meta name="description" content="Fps?" />

  <title>Fps? - AVS Forums</title><!-- Bootstrap core CSS -->
  <link rel="stylesheet" type="text/css" href="//netdna.bootstrapcdn.com/bootswatch/3.0.1/readable/bootstrap.min.css" /><!-- HTML5 shim and Respond.js IE8 support of HTML5 elements and media queries -->
  <!--[if lt IE 9]>
                <script src="https://oss.maxcdn.com/libs/html5shiv/3.7.0/html5shiv.js"></script>
                <script src="https://oss.maxcdn.com/libs/respond.js/1.3.0/respond.min.js"></script>
        <![endif]-->
</head>

<body>
  <div class="container">
    <!-- Put navigation bar here -->

    <ol class="breadcrumb">
      <li><a href="../index.html" class="glyphicon glyphicon-home"></a></li>

      <li><a href="f-85.html">AVS</a></li>

      <li class="active">Fps?</li>
    </ol>

    <p class="lead text-muted">Archive: <a title="Try the Internet Archive" target="_blank" href="http://web.archive.org/web/*/forums.winamp.com/showthread.php?t=241906">Fps?</a></p><br />

    <div class="post">
      <p class="post-meta"><span class="post-author text-primary">fragmer</span><br />
      <p class="post-time small text-muted">27th March 2006 06:27 <abbr title="Coordinated Universal Time<abbr title="Coordinated Universal Time">UTC</abbr></p></p>

      <p class="post-content"><strong>Fps?</strong><br />
      Hello again, AVSers.<br />
      I haven't been actively AVSing for over a year, but recently I've been asked to do FX for a live performance for a friend's band. So...<br />
      <br />
      I'm writing a little AVSTrans library with arrays, vectors, lots of shortcuts and keyboard/mouse functions. Everything is going smoothly so far, except for one simple function - an FPS counter.<br />
      <br />
      For some reason, the old formula:</p>
      <pre>
<code>fps=1/gettime(time);time=gettime(0);</code>
</pre><br />
      doesn't work for me. I get very inaccurate and quantized, widely spaced values - as if AVS is having rounding errors.<br />
      <br />
      Has something changed in AVS while I was absent? Is there a better way? Am I doing something wrong?
    </div>
    <hr />

    <div class="post">
      <p class="post-meta"><span class="post-author text-primary">eheiney</span><br />
      <p class="post-time small text-muted">27th March 2006 06:57 <abbr title="Coordinated Universal Time<abbr title="Coordinated Universal Time">UTC</abbr></p></p>

      <p class="post-content">How about:<br /></p>
      <pre>
<code>fps=gettime(time);time=gettime(0);</code>
</pre><br />
      or<br />
      <pre>
<code>time=gettime(0);dt=time-last;last=time;</code>
</pre>
    </div>
    <hr />

    <div class="post">
      <p class="post-meta"><span class="post-author text-primary">fragmer</span><br />
      <p class="post-time small text-muted">27th March 2006 07:06 <abbr title="Coordinated Universal Time<abbr title="Coordinated Universal Time">UTC</abbr></p></p>

      <p class="post-content">Yes, I am familiar with all those formulas. The problem is, if you check the values that this formula spits out, you see that they are very inaccurate. Try<br /></p>
      <pre>
<code>reg00=1/gettime(time);time=gettime(0);</code>
</pre><br />
      and check the debugger. You'll see that there are just a few fps values that the function spits out - 66.666666 and 62.50000, and sometimes 32.258064 or 31.25000, but not much in between. At least for me.
    </div>
    <hr />

    <div class="post">
      <p class="post-meta"><span class="post-author text-primary">eheiney</span><br />
      <p class="post-time small text-muted">27th March 2006 07:16 <abbr title="Coordinated Universal Time<abbr title="Coordinated Universal Time">UTC</abbr></p></p>

      <p class="post-content">Yeah, I get either 62.4999999 or #INF000000.<br />
      <br />
      I suppose I may be a bit confused about what you're looking for, I've never heard of an FPS counter. What does it do, what is it for, and what were you expecting the values to be?<br />
      <br />
      edit: Gah, okay I know what you're talking about now... I feel stupid. :(<br />
      <br />
      edit2: Still not sure how to fix it though. I know Jheriko posted a few attachments in the past few months with FPS counters but I can't seem to find them anywhere.</p>
    </div>
    <hr />

    <div class="post">
      <p class="post-meta"><span class="post-author text-primary">StevenRoy</span><br />
      <p class="post-time small text-muted">27th March 2006 21:12 <abbr title="Coordinated Universal Time<abbr title="Coordinated Universal Time">UTC</abbr></p></p>

      <p class="post-content">These values look like the sort of thing you might see if you have "Wait for retrace" turned on. The "granularity" between them is a result of the timer's millisecond resolution. This is normal.<br />
      <br />
      If you want "smoother" values, you can use an averaging technique. For example, in one of my presets, I use code similar to this:</p>
      <pre>
<code>t=gettime(0);spd=(spd+(t-lt))*.5;lt=t;<br /><br />reg00=1/spd; // This is the "smoothed" Frames-Per-Second count</code>
</pre>This will smooth out the values, but only a little bit. For something that actually looks like a real FPS counter, more "clever" steps may have to be taken. For example, I just came up with this:
      <pre>
<code>t=gettime(0);spd=(spd+(t-lt))*.5;lt=t;<br /><br />assign(megabuf(fp),spd);fp=(fp+1)%30;<br /><br />if (fp%5,0,<br />  assign(reg00,0)+assign(c,0)+<br />  loop(30,assign(reg00,reg00+megabuf(c))+assign(c,c+1))+<br />  assign(reg00,30/reg00)<br />);</code>
</pre>This calculates the average FPS of the last 30 frames, every five frames. I think that looks rather good. Of course, depending on what you're looking for, you may need to tweak it a bit.<br />
      <br />
      If, by the way, you're only using this value to give your preset "frame-rate independence", then you don't need all this trickiness and you can stick with your original code.
    </div>
    <hr />

    <div class="footer">
      <p class="text-muted small">Fork me on <a href="https://github.com/visbot/AVS-Forums/">GitHub</a></p>
    </div>
  </div><!-- Put JavaScript here -->
</body>
</html>
